I"á<p>This enables <a href="https://plugwise.com">Plugwise</a> <a href="https://www.plugwise.com/en_US/products/anna">Anna</a> thermostats to be integrated. This integration talks locally to your <strong>Smile</strong> interface, and you will need its password and IP address.</p>
<p>The password can be found on the bottom of your Smile, it should consist of 6 characters. To find your IP address use the Plugwise App:</p>
<ul>
<li>Open the Plugwise App and choose the ‚ÄòSettings‚Äô-icon (‚ò∞) and choose ‚ÄòHTML-interface‚Äô.</li>
<li>Go to the (lower) ‚ÄòSettings‚Äô-icon (‚ò∞) and choose ‚ÄòPreferences‚Äô.</li>
<li>Choose ‚ÄòSystem‚Äô then ‚ÄòNetworking‚Äô and your IP address will be shown.</li>
</ul>
<h2>Configuration</h2>
<p>You have to add the following to your configuration.yaml file:</p>
<pre><code class="language-yaml"># Minimal configuration.yaml entry
climate:
  - platform: plugwise
    password: YOUR_SHORT_IP 
    host: YOUR_SMILE_LOCAL_IP
</code></pre>
<p><strong>Please note</strong>: for a legacy Anna (firmware 1.8.x) an additional line is required, see below, this line is not needed for a more recent Anna (firmware 3.1.x).</p>
<div class="config-vars">
  <h3><a class="title-link" name="configuration-variables" href="#configuration-variables"></a> Configuration Variables</h3>
  <dl class=''><dt><a class='title-link' name='password' href='#password'></a> password</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>Your Smile ID (located on the bottom of the Smile, not the Anna).</p>
</span></p></dd><dt><a class='title-link' name='host' href='#host'></a> host</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>The IP address of your Smile.</p>
</span></p></dd><dt><a class='title-link' name='name' href='#name'></a> name</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>The name of your thermostat, i.e., ‚ÄúAnna‚Äù.</p>
</span></p><p class='default'>
Default value: <p>Plugwise Thermostat</p>
</p></dd><dt><a class='title-link' name='username' href='#username'></a> username</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Should you ever need to change this, you can.</p>
</span></p><p class='default'>
Default value: <p>smile</p>
</p></dd><dt><a class='title-link' name='port' href='#port'></a> port</dt><dd><p class='desc'><span class='type'>(<span class='integer'>integer</span>)</span><span class='required'>(Optional)</span><span class='description'><p>When having a custom setup, you can change the port number.</p>
</span></p><p class='default'>
Default value: <p>80</p>
</p></dd><dt><a class='title-link' name='legacy_anna' href='#legacy_anna'></a> legacy_anna</dt><dd><p class='desc'><span class='type'>(<span class='boolean'>boolean</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Indicate that the Anna is a legacy unit</p>
</span></p><p class='default'>
Default value: <p>false</p>
</p></dd><dt><a class='title-link' name='min_temp' href='#min_temp'></a> min_temp</dt><dd><p class='desc'><span class='type'>(<span class='integer'>integer</span>)</span><span class='required'>(Optional)</span><span class='description'><p>If you want to adjust the lower boundary, the integration will not allow temperatures below the set value.</p>
</span></p><p class='default'>
Default value: <p>4</p>
</p></dd><dt><a class='title-link' name='max_temp' href='#max_temp'></a> max_temp</dt><dd><p class='desc'><span class='type'>(<span class='integer'>integer</span>)</span><span class='required'>(Optional)</span><span class='description'><p>If you want to adjust the upper boundary, the integration will not allow temperatures above the set value.</p>
</span></p><p class='default'>
Default value: <p>30</p>
</p></dd></dl>
</div>
<h3>Full configuration example</h3>
<pre><code class="language-yaml">climate:
  - platform: plugwise
    name: YOUR_THERMOSTAT_NAME
    password: YOUR_SHORT_ID
    host: YOUR_SMILE_LOCAL_IP
    port: YOUR_SMILE_PORT_NUMBER
    legacy_anna: true
    min_temp: YOUR_MINIMAL_TARGET_TEMPERATURE
    max_temp: YOUR_MAXIMAL_TARGET_TEMPERATURE
</code></pre>
<h3>Service</h3>
<h4>Set HVAC mode (schedule)</h4>
<p>Service: <code>climate.set_hvac_mode</code></p>
<p>Available options include <code>auto</code> or <code>off</code>. The meaning of <code>auto</code> is that a schedule is active and the thermostat will change presets accordingly. The meaning of <code>off</code> is that there is no schedule active, i.e., the active preset or manually set temperature is to be used to control the climate of your house or rooms.
The last schedule that was active is determined the same way long-tapping the top of Anna works.</p>
<p>Example:</p>
<pre><code class="language-yaml"># Example script change the temperature
script:
  anna_reactive_last_schedule:
    sequence:
      - service: climate.set_hvac_mode
        data:
          hvac_mode: auto
</code></pre>
<p>Changing the active schedule can be done, though not easily:</p>
<ul>
<li>Deactivate the schedule (press the power button on the UI-card).</li>
<li>Look up the available schemas in the <code>states</code> view (attribute <code>available_schemas</code>).</li>
<li>Change the attribute <code>active_schema</code> to the actual name of your schema as available from the above attribute or your Plugwise App.</li>
<li>Activate the schedule (press the calendar button on the UI-card).</li>
</ul>
<h4>Set temperature</h4>
<p>Service: <code>climate.set_temperature</code></p>
<p>Example:</p>
<pre><code class="language-yaml"># Example script change the temperature
script:
  anna_set_predefined_temperature:
    sequence:
      - service: climate.set_temperature
        data:
          temperature: 19.5
</code></pre>
<h4>Set preset mode</h4>
<p>Service: <code>climate.set_preset_mode</code></p>
<p>Available options include: <code>home</code>, <code>vacation</code>, <code>no_frost</code>, <code>asleep</code> &amp; <code>away</code>.</p>
<p>Example:</p>
<pre><code class="language-yaml"># Example script changing the active (or currently set by schedule) preset
script:
  anna_activate_preset_asleep:
    sequence:
      - service: climate.set_preset_mode
        data:
          preset_mode: asleep
</code></pre>
<h3>Troubleshooting</h3>
<p>Example of a working configuration excerpt (with debugging enabled):</p>
<pre><code class="language-txt">[homeassistant.loader] Loaded plugwise from custom_components.plugwise
[homeassistant.loader] You are using a custom integration for plugwise which has not been tested by Home Assistant. This component might cause stability problems, be sure to disable it if you do experience issues with Home Assistant.
[custom_components.plugwise.climate] Plugwise: custom component loading (Anna PlugWise climate)
[homeassistant.components.climate] Setting up climate.plugwise
[custom_components.plugwise.climate] Init called
[custom_components.plugwise.climate] Initializing API
[custom_components.plugwise.climate] platform ready
[custom_components.plugwise.climate] Update called
</code></pre>
<p>Example of something going wrong (IP address not set) excerpt is shown below. Correct your configuration and try again. If the errors persist, please share a larger excerpt of your logfile.</p>
<pre><code class="language-txt">1970-01-01 00:00:01 ERROR (MainThread) [homeassistant.components.climate] Error while setting up platform plugwise
  File &quot;/home/homeassistant/.homeassistant/custom_components/plugwise/climate.py&quot;, line 104, in setup_platform
  File &quot;/home/homeassistant/.homeassistant/custom_components/plugwise/climate.py&quot;, line 130, in __init__
    self._api = Haanna(self._username, self._password, self._host, self._port)
</code></pre>
:ET