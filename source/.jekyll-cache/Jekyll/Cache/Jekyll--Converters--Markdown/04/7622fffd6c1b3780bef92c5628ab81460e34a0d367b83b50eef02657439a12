I"÷<p>Set up <a href="https://mosquitto.org/">Mosquitto</a> as MQTT broker.</p>
<pre><code class="language-json">{
  &quot;logins&quot;: [
    {&quot;username&quot;: &quot;local-user&quot;, &quot;password&quot;: &quot;mypw&quot;}
  ],
  &quot;anonymous&quot;: false,
  &quot;customize&quot;: {
    &quot;active&quot;: false,
    &quot;folder&quot;: &quot;mosquitto&quot;
  },
  &quot;certfile&quot;: &quot;fullchain.pem&quot;,
  &quot;keyfile&quot;: &quot;privkey.pem&quot;
}
</code></pre>
<div class='warning note'>
<p>Since version 4.1 of the addon, an explicit ACL definition is now required if you plan to use legacy logins and <code>&quot;anonymous&quot;: true</code> <a href="https://www.home-assistant.io/addons/mosquitto/#access-control-lists-acls">see these instructions</a>.</p>
</div>
<div class="config-vars">
  <h3><a class="title-link" name="configuration-variables" href="#configuration-variables"></a> Configuration Variables</h3>
  <dl class=''><dt><a class='title-link' name='anonymous' href='#anonymous'></a> anonymous</dt><dd><p class='desc'><span class='type'>(<span class='boolean'>boolean</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Allow anonymous connections. If <em>logins</em> is set, the anonymous user can only read data.</p>
</span></p><p class='default'>
Default value: <p>false</p>
</p></dd><dt><a class='title-link' name='logins' href='#logins'></a> logins</dt><dd><p class='desc'><span class='type'>(<span class='list'>list</span>)</span><span class='required'>(Optional)</span><span class='description'><p>A list of local users that will be created with <em>username</em> and <em>password</em>. You don‚Äôt need do this because you can use Home Assistant users too without any configuration.</p>
</span></p></dd><dt><a class='title-link' name='customize' href='#customize'></a> customize</dt><dd><p class='desc'><span class='type'>(<span class='boolean string'>boolean | string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>If you enable it, it reads additional configuration files (<code>*.conf</code>) from <code>/share/mosquitto</code>.</p>
</span></p><p class='default'>
Default value: <p>false</p>
</p></dd><dt><a class='title-link' name='cafile' href='#cafile'></a> cafile</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Path to the CA certificate. If not set, will default to the <em>certfile</em> value.</p>
</span></p><p class='default'>
Default value: <p>certfile</p>
</p></dd><dt><a class='title-link' name='require_certificate' href='#require_certificate'></a> require_certificate</dt><dd><p class='desc'><span class='type'>(<span class='boolean'>boolean</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Restrict to users with a valid certificate only.</p>
</span></p><p class='default'>
Default value: <p>false</p>
</p></dd></dl>
</div>
<h3>Home Assistant user management</h3>
<p>This add-on is attached to the Home Assistant user system, so mqtt clients can make use of these credentials. Local users may also still be set independently within the configuration options for the add-on.  For the internal Hass.io ecosystem we register <code>homeassistant</code> and <code>addons</code>, so these may not be used as user names.</p>
<h3>Home Assistant configuration</h3>
<p>To use the Mosquitto as <a href="/docs/mqtt/broker/#run-your-own">broker</a>, go to the integration page and install the configuration with one click. If you have old MQTT settings available, remove this old integration and restart Home Assistant to see the new one.</p>
<h4>Using Mosquitto with Hass.io</h4>
<ol>
<li>
<p>Install the <a href="/addons/mosquitto/">Mosquitto add-on</a> with the default configuration via ‚ÄòHass.io &gt; ADD-ON STORE‚Äô. (Don‚Äôt forget to start the add-on &amp; verify that ‚ÄòStart on boot‚Äô is enabled.)</p>
</li>
<li>
<p>Create a new user for MQTT via the <code>Configuration &gt; Users (manage users)</code>. (Note: This name cannot be ‚Äúhomeassistant‚Äù or ‚Äúaddon‚Äù)</p>
</li>
<li>
<p>Once back on-line, return to <code>Configuration &gt; Integrations</code> and select configure next to <code>MQTT</code>.</p>
</li>
</ol>
<pre><code class="language-text">  Broker: YOUR_HASSIO_IP_ADDRESS
  Port: 1883
  Username: MQTT_USERNAME
  Password: MQTT_PASSWORD
</code></pre>
<p>If you are using the ACL, remember to enter the newly created user and homeassistant in <code>/share/mosquitto/accesscontrollist</code> as follows:</p>
<pre><code class="language-text">user [YOUR_MQTT_USER]
topic readwrite #
user homeassistant
topic readwrite #
</code></pre>
<p>Note: .yaml modifications are not required.
See <a href="/docs/mqtt/testing/">testing your setup</a> to verify the steps above.</p>
<h3>Disable listening on insecure (1883) ports</h3>
<p>Remove the ports from the add-on page network card (set them as blank) to disable them.</p>
<h3>Access Control Lists (ACLs)</h3>
<p>It is possible to restrict access to topics based upon the user logged in to Mosquitto. In this scenario it is recommended to create individual users for each of your clients and create an appropriate ACL.</p>
<p>See the following links for more information:</p>
<ul>
<li><a href="http://www.steves-internet-guide.com/topic-restriction-mosquitto-configuration/">Mosquitto topic restrictions</a></li>
<li><a href="https://mosquitto.org/man/mosquitto-conf-5.html">Mosquitto.conf man page</a></li>
</ul>
<p>Add the following configuration to enable <strong>unrestricted</strong> access to all topics.</p>
<ol>
<li>Enable the customize flag</li>
</ol>
<pre><code class="language-json">  &quot;customize&quot;: {
    &quot;active&quot;: true,
    &quot;folder&quot;: &quot;mosquitto&quot;
  },
</code></pre>
<ol start="2">
<li>Create <code>/share/mosquitto/acl.conf</code> with the contents:</li>
</ol>
<pre><code class="language-text">acl_file /share/mosquitto/accesscontrollist
</code></pre>
<ol start="3">
<li>Create <code>/share/mosquitto/accesscontrollist</code> with the contents:</li>
</ol>
<pre><code class="language-text">user [YOUR_MQTT_USER]
topic readwrite #
</code></pre>
<p>The <code>/share</code> folder can be accessed via SMB, or on the host filesystem under <code>/usr/share/hassio/share</code>.</p>
:ET