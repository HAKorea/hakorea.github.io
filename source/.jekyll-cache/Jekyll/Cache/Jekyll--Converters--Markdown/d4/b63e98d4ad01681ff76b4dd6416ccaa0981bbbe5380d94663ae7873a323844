I"<p><a href="https://caddyserver.com/">Caddy Server</a> is a powerful HTTP/2 server, that enables HTTPS by default with automatically generated Letâ€™s Encrypt certificates, which allows a simple configuration procces.</p>
<p>Using Caddy as a proxy for Home Assistant allows you to serve Home Assistant securely over standard ports. This configuration file and instructions will walk you through setting up Home Assistant over a secure connection.</p>
<h3>1. Get a domain name forwarded to your IP</h3>
<p>Chances are, you have a dynamic IP address (your ISP changes your address periodically). If this is true, you can use a Dynamic DNS service to obtain a domain and set it up to update with you IP. If you purchase your own domain name, you will be able to easily get a trusted SSL certificate later.</p>
<h3>2. Install Caddy on your server</h3>
<p>This will vary depending on your OS. Caddy has a <a href="https://caddyserver.com/download">nice utillity</a> that generates an installer script.</p>
<div class='note'>
    Make sure you include the `hook.service` plugin if you want to run Caddy as a service
</div>
<h3>3. Port forwarding.</h3>
<p>Forward ports 443 and 80 to your server on your router. Do not forward port 8123.</p>
<h3>4. Create Caddyfile.</h3>
<p>Use this as your Caddyfile, change the domain name to match yours.</p>
<pre><code class="language-text">example.com {
    proxy / localhost:8123 {
        websocket
        transparent
    }
}
</code></pre>
<h3>5. Configure Home Assistant</h3>
<p>Home Assistant is still available without using the Caddy proxy. Restricting it to only listen to <code>127.0.0.1</code> will forbid direct accesses. Also, Home Assistant should be told to trust headers coming from Caddy proxy only. Otherwise, incoming requests will always come from <code>127.0.0.1</code> and not the real IP address.</p>
<p>On your <code>configuration.yaml</code> file, edit the <code>http</code> component.</p>
<pre><code class="language-yaml">http:
  # For extra security set this to only accept connections on localhost if Caddy is on the same machine
  # server_host: 127.0.0.1
  # Update this line to be your domain
  base_url: https://example.com
  use_x_forwarded_for: true
  # You must set the trusted proxy IP address so that Home Assistant will properly accept connections
  # Set this to your Caddy machine IP, or localhost if hosted on the same machine.
  trusted_proxies: &lt;Caddy IP address here, or 127.0.0.1 if hosted on the same machine&gt;
</code></pre>
<h3>6. Start Caddy</h3>
<p>You can either start Caddy or <a href="https://github.com/mholt/caddy/wiki/Caddy-as-a-service-examples">install it as a service</a>, pass the Caddyfile path as a <code>conf</code> parameter.
Home Assistant will be listening on port 443 (HTTPS) and all insecure traffic on port 80 will be redirected.</p>
:ET