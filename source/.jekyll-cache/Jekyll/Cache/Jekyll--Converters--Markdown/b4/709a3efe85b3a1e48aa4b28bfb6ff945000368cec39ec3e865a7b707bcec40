I"⁄<p>With the <code>cloudflare</code> integration, you can keep your Cloudflare records up to date.</p>
<p>The integration runs every hour, but can also be started manually by using the service <code>cloudflare.update_records</code> under services.</p>
<h2>Setup</h2>
<p>You can find your global API key in your Cloudflare account settings.</p>
<h2>Configuration</h2>
<p>To use the integration in your installation, add the following to your <code>configuration.yaml</code> file:</p>
<pre><code class="language-yaml"># Example configuration.yaml entry
cloudflare:
  email: YOUR_EMAIL_ADDRESS
  api_key: YOUR_GLOBAL_API_KEY
  zone: EXAMPLE.COM
  records:
    - ha
    - www
</code></pre>
<div class="config-vars">
  <h3><a class="title-link" name="configuration-variables" href="#configuration-variables"></a> Configuration Variables</h3>
  <dl class=''><dt><a class='title-link' name='email' href='#email'></a> email</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>The email address for your Cloudflare account.</p>
</span></p></dd><dt><a class='title-link' name='api_key' href='#api_key'></a> api_key</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>The global API key for your Cloudflare account.</p>
</span></p></dd><dt><a class='title-link' name='zone' href='#zone'></a> zone</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>The DNS zone (domain) you want to update.</p>
</span></p></dd><dt><a class='title-link' name='records' href='#records'></a> records</dt><dd><p class='desc'><span class='type'>(<span class='list'>list</span>)</span><span class='required'>(Required)</span><span class='description'><p>A list of records (subdomains) you want to update.</p>
</span></p></dd></dl>
</div>
<h2>Additional information</h2>
<h3>Usage of external service</h3>
<p>This platform uses the API from <a href="https://www.ipify.org/">ipify.org</a> to set the public IP address.</p>
<h3>API Key</h3>
<p>Please note that the <code>api_key</code> is the <a href="https://support.cloudflare.com/hc/en-us/articles/200167836-Managing-API-Tokens-and-Keys#12345682">global API key</a> of your Cloudflare account (not the API Token).</p>
<h3>Home Assistant Companion App</h3>
<p>If you would like to use <a href="https://companion.home-assistant.io/">iOS App</a> via Cloudflare set <strong>Minimum TLS version as 1.2</strong>, in order to do that, do the following:</p>
<ol>
<li>Login to your <a href="https://dash.cloudflare.com/">Cloudflare</a> account.</li>
<li>Choose your domain.</li>
<li>Click on the <code>SSL/TLS</code> icon.</li>
<li>Go to tab <code>Edge Certificates</code>.</li>
<li>Find <code>Minimum TLS Version</code> and set it to <strong>1.2</strong>.</li>
</ol>
<p>Other settings should not cause any issues.</p>
<h3>SSH over Cloudflare</h3>
<p>For SSH usage (according to <a href="https://blog.cloudflare.com/cloudflare-now-supporting-more-ports/">this</a> source), you need to connect directly to your server (bypassing Cloudflare). To do that, create a <code>CNAME</code> DNS record, e.g., <code>ssh.example.com</code>, with proxy status as ‚ÄúDNS only‚Äù (to do that click on orange icon, it will change color to gray) and then connect to <code>ssh.example.com</code> using your server SSH port.</p>
<h3>Using Cloudflare domain only for Home Assistant</h3>
<p>If you want to update just a main domain, place in the records list only your domain, e.g., <code>example.com</code>. It will update your <code>A</code> DNS record with your IP every hour.</p>
<pre><code class="language-yaml"># Example configuration.yaml entry for one domain
cloudflare:
  email: YOUR_EMAIL_ADDRESS
  api_key: YOUR_GLOBAL_API_KEY
  zone: EXAMPLE.COM
  records:
    - EXAMPLE.COM
</code></pre>
<h4>The minimum DNS record settings are (if you have set up https already):</h4>
<p>To redirect from your domain to the IP address of your Home Assistant server set this DNS record:</p>
<pre><code class="language-text">Type: A
Name: @
IPv4 Address: your.ip.address
</code></pre>
<p>You can find your current IP address using <a href="https://api.ipify.org/">this</a> page.</p>
<p>In order to redirect from <code>https://www</code> to <code>https://</code> you need to set this DNS record:</p>
<pre><code class="language-text">Type: CNAME
Name: @
Target: example.com (your actual domain)
</code></pre>
<p>And also create Page Rule:</p>
<pre><code class="language-text">If the URL matches: www.example.com*
Then the settings are: Forwarding URL
Status: 302 - Temporary redirect
Destination URL: https://example.com/$1
</code></pre>
:ET