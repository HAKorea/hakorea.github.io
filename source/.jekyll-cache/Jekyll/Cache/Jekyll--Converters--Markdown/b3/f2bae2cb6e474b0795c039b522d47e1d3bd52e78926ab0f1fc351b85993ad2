I"â+<p>The <code>doods</code> image processing platform allows you to detect and recognize objects in a camera image using <a href="https://github.com/snowzach/doods/">DOODS</a>. The state of the entity is the number of objects detected, and recognized objects are listed in the <code>summary</code> attribute along with quantity. The <code>matches</code> attribute provides the confidence <code>score</code> for recognition and the bounding <code>box</code> of the object for each detection category.</p>
<h2>Setup</h2>
<p>You need to have DOODS running somewhere. Itâ€™s easiest to run as a docker container and deployment is described on docker hub
<a href="https://hub.docker.com/r/snowzach/doods">DOODS - Docker</a></p>
<h2>Configuration</h2>
<p>The configuration loosely follows the tensorflow configuration. To enable this platform in your installation, add the following to your <code>configuration.yaml</code> file:</p>
<pre><code class="language-yaml"># Example configuration.yaml entry
image_processing:
  - platform: doods
    url: &quot;http://&lt;my doods server&gt;:8080&quot;
    detector: default
    source:
      - entity_id: camera.front_yard
</code></pre>
<div class="config-vars">
  <h3><a class="title-link" name="configuration-variables" href="#configuration-variables"></a> Configuration Variables</h3>
  <dl class=''><dt><a class='title-link' name='source' href='#source'></a> source</dt><dd><p class='desc'><span class='type'>(<span class='map'>map</span>)</span><span class='required'>(Required)</span><span class='description'><p>The list of image sources.</p>
</span></p></dd><dd><dl class='nested'><dt><a class='title-link' name='entity_id' href='#entity_id'></a> entity_id</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>A camera entity id to get picture from.</p>
</span></p></dd><dt><a class='title-link' name='name' href='#name'></a> name</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>This parameter allows you to override the name of your <code>image_processing</code> entity.</p>
</span></p></dd></dl></dd><dt><a class='title-link' name='url' href='#url'></a> url</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>The URL of the DOODS server</p>
</span></p></dd><dt><a class='title-link' name='timeout' href='#timeout'></a> timeout</dt><dd><p class='desc'><span class='type'>(<span class='integer'>integer</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Timeout for requests (in seconds)</p>
</span></p><p class='default'>
Default value: <p>90</p>
</p></dd><dt><a class='title-link' name='detector' href='#detector'></a> detector</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>The DOODS detector to use</p>
</span></p></dd><dt><a class='title-link' name='confidence' href='#confidence'></a> confidence</dt><dd><p class='desc'><span class='type'>(<span class='float'>float</span>)</span><span class='required'>(Optional)</span><span class='description'><p>The default confidence for any detected objects where not explicitly set</p>
</span></p></dd><dt><a class='title-link' name='area' href='#area'></a> area</dt><dd><p class='desc'><span class='type'>(<span class='map'>map</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Global detection area. Objects in this box will be reported. Top of image is 0, bottom is 1.  Same left to right.</p>
</span></p></dd><dd><dl class='nested'><dt><a class='title-link' name='top' href='#top'></a> top</dt><dd><p class='desc'><span class='type'>(<span class='float'>float</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Top line defined as % from top of image.</p>
</span></p><p class='default'>
Default value: <p>0</p>
</p></dd><dt><a class='title-link' name='left' href='#left'></a> left</dt><dd><p class='desc'><span class='type'>(<span class='float'>float</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Left line defined as % from left of image.</p>
</span></p><p class='default'>
Default value: <p>0</p>
</p></dd><dt><a class='title-link' name='bottom' href='#bottom'></a> bottom</dt><dd><p class='desc'><span class='type'>(<span class='float'>float</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Bottom line defined as % from top of image.</p>
</span></p><p class='default'>
Default value: <p>1</p>
</p></dd><dt><a class='title-link' name='right' href='#right'></a> right</dt><dd><p class='desc'><span class='type'>(<span class='float'>float</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Right line defined as % from left of image.</p>
</span></p><p class='default'>
Default value: <p>1</p>
</p></dd><dt><a class='title-link' name='covers' href='#covers'></a> covers</dt><dd><p class='desc'><span class='type'>(<span class='boolean'>boolean</span>)</span><span class='required'>(Optional)</span><span class='description'><p>If true the detection must be fully in this box. If false any part of the detection in the box will trigger.</p>
</span></p><p class='default'>
Default value: <p>true</p>
</p></dd></dl></dd><dt><a class='title-link' name='file_out' href='#file_out'></a> file_out</dt><dd><p class='desc'><span class='type'>(<span class='list'>list</span>)</span><span class='required'>(Optional)</span><span class='description'><p>A <a href="/docs/configuration/templating/#processing-incoming-data">template</a> for the integration to save processed images including bounding boxes. <code>camera_entity</code> is available as the <code>entity_id</code> string of the triggered source camera.</p>
</span></p></dd><dt><a class='title-link' name='labels' href='#labels'></a> labels</dt><dd><p class='desc'><span class='type'>(<span class='map'>map</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Information about the selected labels model.</p>
</span></p></dd><dd><dl class='nested'><dt><a class='title-link' name='name' href='#name'></a> name</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>The label of the object to select for detection.</p>
</span></p></dd><dt><a class='title-link' name='confidence' href='#confidence'></a> confidence</dt><dd><p class='desc'><span class='type'>(<span class='float'>float</span>)</span><span class='required'>(Optional)</span><span class='description'><p>The minimum confidence for the selected label</p>
</span></p></dd><dt><a class='title-link' name='area' href='#area'></a> area</dt><dd><p class='desc'><span class='type'>(<span class='map'>map</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Custom detection area. Only objects fully in this box will be reported. Top of image is 0, bottom is 1.  Same left to right.</p>
</span></p></dd><dd><dl class='nested'><dt><a class='title-link' name='top' href='#top'></a> top</dt><dd><p class='desc'><span class='type'>(<span class='float'>float</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Top line defined as % from top of image.</p>
</span></p><p class='default'>
Default value: <p>0</p>
</p></dd><dt><a class='title-link' name='left' href='#left'></a> left</dt><dd><p class='desc'><span class='type'>(<span class='float'>float</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Left line defined as % from left of image.</p>
</span></p><p class='default'>
Default value: <p>0</p>
</p></dd><dt><a class='title-link' name='bottom' href='#bottom'></a> bottom</dt><dd><p class='desc'><span class='type'>(<span class='float'>float</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Bottom line defined as % from top of image.</p>
</span></p><p class='default'>
Default value: <p>1</p>
</p></dd><dt><a class='title-link' name='right' href='#right'></a> right</dt><dd><p class='desc'><span class='type'>(<span class='float'>float</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Right line defined as % from left of image.</p>
</span></p><p class='default'>
Default value: <p>1</p>
</p></dd><dt><a class='title-link' name='covers' href='#covers'></a> covers</dt><dd><p class='desc'><span class='type'>(<span class='boolean'>boolean</span>)</span><span class='required'>(Optional)</span><span class='description'><p>If true the detection must be fully in this box. If false any part of the detection in the box will trigger.</p>
</span></p><p class='default'>
Default value: <p>true</p>
</p></dd></dl></dd></dl></dd></dl>
</div>
<pre><code class="language-yaml"># Example advanced configuration.yaml entry
# Example configuration.yaml entry
image_processing:
  - platform: doods
    scan_interval: 1000
    url: &quot;http://&lt;my doods server&gt;:8080&quot;
    timeout: 60
    detector: default
    source:
      - entity_id: camera.front_yard
    file_out:
      - &quot;/tmp/{{ camera_entity.split('.')[1] }}_latest.jpg&quot;
      - &quot;/tmp/{{ camera_entity.split('.')[1] }}_{{ now().strftime('%Y%m%d_%H%M%S') }}.jpg&quot;
    confidence: 50
    # This global detection area is required for all labels
    area:
      # Exclude top 10% of image
      top: 0.1
      # Exclude right 5% of image
      right: 0.95
      # The entire detection must be inside this box
      covers: true
    labels:
      - name: person
        confidence: 40
        area:
          # Exclude top 10% of image
          top: 0.1
          # Exclude right 15% of image
          right: 0.85
          # Any part of the detection inside this area will trigger
          covers: false
      - car
      - truck
</code></pre>
<h2>Optimizing resources</h2>
<p><a href="/components/image_processing/">Image processing components</a> process the image from a camera at a fixed period given by the <code>scan_interval</code>. This leads to excessive processing if the image on the camera hasnâ€™t changed, as the default <code>scan_interval</code> is 10 seconds. You can override this by adding to your config <code>scan_interval: 10000</code> (setting the interval to 10,000 seconds), and then call the <code>image_processing.scan</code> service when you actually want to perform processing.</p>
<pre><code class="language-yaml"># Example advanced configuration.yaml entry
image_processing:
  - platform: doods
    scan_interval: 10000
    source:
      - entity_id: camera.driveway
      - entity_id: camera.backyard
</code></pre>
<pre><code class="language-yaml"># Example advanced automations.yaml entry
- alias: Doods scanning
  trigger:
     - platform: state
       entity_id:
         - binary_sensor.driveway
  action:
    - service: image_processing.scan
      entity_id: image_processing.doods_camera_driveway
</code></pre>
:ET