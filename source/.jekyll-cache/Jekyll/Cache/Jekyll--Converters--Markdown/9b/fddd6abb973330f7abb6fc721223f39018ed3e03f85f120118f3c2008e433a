I"^3<p>The <code>aws</code> integration provides a single place to interact with <a href="https://aws.amazon.com/">Amazon Web Services</a>. Currently it provides a notification platform that can send a message to <a href="https://aws.amazon.com/sqs/">AWS SQS</a>, <a href="https://aws.amazon.com/sns/">AWS SNS</a>, or invoke <a href="https://aws.amazon.com/lambda/">AWS Lambda</a> functions.</p>
<h2>Setup</h2>
<p>You have to have an AWS account to use Amazon Web Services, create one <a href="https://aws.amazon.com/free/">here</a> with a 12 months free tier benefit. Please note, even in the first 12-months, you may still be billed if you use more resources than offered in the free tier. We advise you to monitor your costs in the <a href="https://console.aws.amazon.com/billing/">AWS Billing Console</a> closely. You can read the <a href="https://aws.amazon.com/getting-started/tutorials/control-your-costs-free-tier-budgets/">Control your AWS costs</a> guide for more information.</p>
<p>The <code>lambda</code>, <code>sns</code> and <code>sqs</code> services, used in the <code>aws</code> component, all provide an <strong>Always Free</strong> tier for all users even after the 12-month period. The general usage in Home Automation will most likely not reach the free tier limit. Please read <a href="https://aws.amazon.com/lambda/pricing/">Lambda Pricing</a>, <a href="https://aws.amazon.com/sns/pricing/">SNS Pricing</a> and <a href="https://aws.amazon.com/sqs/pricing/">SQS Pricing</a> for more details.</p>
<p>The <code>aws</code> integration is using <a href="https://botocore.amazonaws.com/v1/documentation/api/latest/index.html">botocore</a> to communicate with Amazon Web Services, which is also used by the <a href="https://aws.amazon.com/cli/">AWS Command Client Interface</a> tool. Therefore, <code>aws</code> shares the same credential and profiles with <code>awscli</code> tool. Please read <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html">Configuring the AWS CLI</a> to learn how to get access keys and how to manage them on your local system securely.</p>
<h2>Configuration</h2>
<p>To use the <code>aws</code> integration and the <code>notify</code> platform in your installation, add the following to your <code>configuration.yaml</code> file:</p>
<pre><code class="language-yaml"># Example configuration.yaml entry
aws:
  credentials:
    - name: My AWS Account
      aws_access_key_id: AWS_ID
      aws_secret_access_key: AWS_SECRET
  notify:
    # use the first credential defined in aws integration by default
    - service: lambda
      region_name: us-east-1
</code></pre>
<h3>Configuration for credentials</h3>
<div class="config-vars">
  <h3><a class="title-link" name="configuration-variables" href="#configuration-variables"></a> Configuration Variables</h3>
  <dl class=''><dt><a class='title-link' name='name' href='#name'></a> name</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>Give your AWS credential a name, so that you can refer it in other AWS platforms.</p>
</span></p></dd><dt><a class='title-link' name='aws_access_key_id' href='#aws_access_key_id'></a> aws_access_key_id</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Your AWS Access Key ID. If provided, you must also provide an <code>aws_secret_access_key</code> and must <strong>not</strong> provide a <code>profile_name</code>. Required if <code>aws_secret_access_key</code> is provided.</p>
</span></p></dd><dt><a class='title-link' name='aws_secret_access_key' href='#aws_secret_access_key'></a> aws_secret_access_key</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Your AWS Secret Access Key. If provided, you must also provide an <code>aws_access_key_id</code> and must <strong>not</strong> provide a <code>profile_name</code>. Required if <code>aws_access_key_id</code> is provided.</p>
</span></p></dd><dt><a class='title-link' name='profile_name' href='#profile_name'></a> profile_name</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>A credentials profile name.</p>
</span></p></dd><dt><a class='title-link' name='validate' href='#validate'></a> validate</dt><dd><p class='desc'><span class='type'>(<span class='boolean'>boolean</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Whether validate credential before use. Validate credential needs <code>IAM.GetUser</code> permission.</p>
</span></p><p class='default'>
Default value: <p>true</p>
</p></dd></dl>
</div>
<h3>Configuration for notify</h3>
<div class="config-vars">
  <h3><a class="title-link" name="configuration-variables" href="#configuration-variables"></a> Configuration Variables</h3>
  <dl class=''><dt><a class='title-link' name='service' href='#service'></a> service</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>Amazon Web Services will be used for notification. You can choose from <code>lambda</code>, <code>sns</code>, or <code>sqs</code>.</p>
</span></p></dd><dt><a class='title-link' name='region_name' href='#region_name'></a> region_name</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>The region identifier to connect to, for example, <code>us-east-1</code>.</p>
</span></p></dd><dt><a class='title-link' name='credential_name' href='#credential_name'></a> credential_name</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>A reference to an <code>aws</code> credential. Notify platform will use the <code>default profile</code> defined in <code>~/.aws</code> if none of <code>credential_name</code>, <code>aws_access_key_id</code>, or <code>profile_name</code> was given.</p>
</span></p></dd><dt><a class='title-link' name='aws_access_key_id' href='#aws_access_key_id'></a> aws_access_key_id</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Your AWS Access Key ID. If provided, you must also provide an <code>aws_secret_access_key</code>.</p>
</span></p></dd><dt><a class='title-link' name='aws_secret_access_key' href='#aws_secret_access_key'></a> aws_secret_access_key</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Your AWS Secret Access Key. If provided, you must also provide an <code>aws_access_key_id</code>. Required if aws_access_key_id is provided.</p>
</span></p></dd><dt><a class='title-link' name='profile_name' href='#profile_name'></a> profile_name</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>A credentials profile name.</p>
</span></p></dd><dt><a class='title-link' name='name' href='#name'></a> name</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Setting the optional parameter <code>name</code> allows multiple notifiers to be created. The notifier will bind to the service <code>notify.NOTIFIER_NAME</code>.</p>
</span></p><p class='default'>
Default value: <p>notify</p>
</p></dd><dt><a class='title-link' name='context' href='#context'></a> context</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>An optional dictionary you can provide to pass custom context through to the notification handler.</p>
</span></p></dd></dl>
</div>
<h2>Lambda Notify Usage</h2>
<p>AWS Lambda is a notification platform and thus can be controlled by calling the <code>notify</code> service <a href="/integrations/notify/">as described here</a>. It will invoke a Lambda for all targets given in the notification payload. A target can be formatted as a function name, an entire ARN (<a href="https://docs.aws.amazon.com/general/latest/gr/aws-arns-and-namespaces.html">Amazon Resource Name</a>) or a partial ARN. For more information, please see the <a href="https://botocore.amazonaws.com/v1/documentation/api/latest/reference/services/lambda.html#Lambda.Client.invoke">botocore docs</a>.</p>
<p>The Lambda event payload will contain everything passed in the service call payload. Here is an example payload that would be sent to Lambda:</p>
<pre><code class="language-json">{
  &quot;title&quot;: &quot;Test message!&quot;,
  &quot;target&quot;: &quot;arn:aws:lambda:us-east-1:123456789012:function:ProcessKinesisRecords&quot;,
  &quot;data&quot;: {
    &quot;test&quot;: &quot;okay&quot;
  },
  &quot;message&quot;: &quot;Hello world!&quot;
}
</code></pre>
<p>The context will look like this:</p>
<pre><code class="language-json">{
  &quot;custom&quot;: {
    &quot;two&quot;: &quot;three&quot;,
    &quot;test&quot;: &quot;one&quot;
  }
}
</code></pre>
<h2>SNS Notify Usage</h2>
<p>AWS SNS is a notification platform and thus can be controlled by calling the <code>notify</code> service <a href="/integrations/notify/">as described here</a>. It will publish a message to all targets given in the notification payload. A target must be a SNS topic or endpoint ARN (<a href="https://docs.aws.amazon.com/general/latest/gr/aws-arns-and-namespaces.html">Amazon Resource Name</a>). For more information, please see the <a href="https://botocore.amazonaws.com/v1/documentation/api/latest/reference/services/sns.html#SNS.Client.publish">botocore docs</a>.</p>
<p>If one exists, the SNS Subject will be set to the title. All attributes from the payload, except the message, will be sent as stringified message attributes.</p>
<h3>Setting up SNS within AWS</h3>
<ul>
<li>Log into your AWS console and under “Security and Identity”, select “Identity &amp; Access Management”.</li>
<li>On the left-hand side, select “Users” then click “Create New Users”. Enter a name here and then click “Create”.</li>
<li>You can either download the credentials or click the arrow to display them one time.</li>
</ul>
<div class='note warning'>
If you do not download them, you will lose them and will have to recreate a new user.
</div>
<ul>
<li>Copy/Paste the two keys that are shown here in your <code>configuration.yaml</code> file.</li>
<li>On the left-hand side of the screen go back to “Users” and select the user you just created. On the “Permissions” tab click the “Attach Policy” icon. Search for “SNS” and attach the policy “AmazonSNSFUullAccess”.</li>
<li>Back to the AWS Console you now need to find “SNS” and click in to that service. It is under the Mobile Services group.</li>
<li>On the left-hand side, select “Topics” then “Create new topic”.</li>
<li>Choose a Topic Name and Display Name.</li>
<li>Now check the box next to the Topic you just created and under Actions, select “Subscribe to topic”.</li>
<li>In the box that pops up, select the Protocol = SMS and enter in the phone number next to “Endpoint” you wish to SMS. Now click “Create”.</li>
<li>Repeat for additional numbers.</li>
<li>Back in the “Users” section you will see a long alphanumeric line that starts with “arn:” and ends with the Topic Name you choose previously. This is what your “target” in Home Assistant will be.</li>
</ul>
<h2>SQS Notify Usage</h2>
<p>AWS SQS is a notification platform and thus can be controlled by calling the <code>notify</code> service <a href="/integrations/notify/">as described here</a>. It will publish a message to the queue for all targets given in the notification payload. A target must be a SQS topic URL. For more information, please see the <a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/ImportantIdentifiers.html">SQS docs</a> and <a href="https://botocore.amazonaws.com/v1/documentation/api/latest/reference/services/sqs.html#SQS.Client.send_message">bototcore docs</a></p>
<p>The SQS event payload will contain everything passed in the service call payload. SQS payloads will be published as stringified JSON. All attributes from the payload, except message, will also be sent as stringified message attributes. Here is an example message that would be published to the SQS queue:</p>
<pre><code class="language-json">{
  &quot;title&quot;: &quot;Test message!&quot;,
  &quot;target&quot;: &quot;https://sqs.us-east-1.amazonaws.com/123456789012/queue2%22&quot;,
  &quot;data&quot;: {
    &quot;test&quot;: &quot;okay&quot;
  },
  &quot;message&quot;: &quot;Hello world!&quot;
}
</code></pre>
:ET