I"õ<p>This example demonstrates how you can configure NGINX to act as a proxy for Home Assistant.</p>
<p>This is useful if you want to have:</p>
<ul>
<li>a subdomain redirecting to your Home Assistant instance</li>
<li>several subdomain for several instance</li>
<li>HTTPS redirection</li>
</ul>
<h4>Subdomain</h4>
<p>So you already have a working NGINX server available at example.org. Your Home Assistant is correctly working on this web server and available at <code>http://localhost:8123</code></p>
<p>To be able to access to your Home Assistant instance by using <code>https://home.example.org</code>, create file <code>/etc/nginx/sites-enabled/homeassistant</code> (or symlink via <code>/etc/nginx/sites-available</code>) and add the following:</p>
<pre><code class="language-nginx">server {
    listen       443 ssl;
    server_name  home.example.org;
    
    ssl on;
    ssl_certificate /etc/nginx/ssl/home.example.org/home.example.org-bundle.crt;
    ssl_certificate_key /etc/nginx/ssl/home.example.org/home.example.org.key;
    ssl_prefer_server_ciphers on;

    location / {
        proxy_pass http://localhost:8123;
        proxy_set_header Host $host;

        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection &quot;upgrade&quot;;
    }

    location /api/websocket {
        proxy_pass http://localhost:8123/api/websocket;
        proxy_set_header Host $host;

        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection &quot;upgrade&quot;;

    }
}
</code></pre>
<p>If you donâ€™t want HTTPS, you can change <code>listen 443 ssl</code> to <code>listen 80</code> or better, consider redirecting all HTTP to HTTPS. See further down.</p>
<h4>Multiple Instance</h4>
<p>You already have Home Assistant running on <code>http://localhost:8123</code> and available at home.example.org as describe before. The configuration file for this Home Assistant is available in <code>/home/alice/.homeassistant/configuration.yaml</code>.</p>
<p>You want another instance available at <code>https://countryside.example.org</code></p>
<p>You can either :</p>
<ul>
<li>Create a new user, <code>bob</code>, to hold the configuration file in <code>/home/bob/.homeassistant/configuration.yaml</code> and run Home Assistant as this new user</li>
<li>Create another configuration directory in <code>/home/alice/.homeassistant2/configuration.yaml</code> and run Home Assistant using <code>hass --config /home/alice/.homeassistant2/</code></li>
</ul>
<p>In both solution, change port number used by modifying <code>configuration.yaml</code> file.</p>
<pre><code class="language-yaml">http:
  server_port: 8124
  ...
</code></pre>
<p>Start Home Assistant: Now, you have another instance running on <code>http://localhost:8124</code></p>
<p>To access this instance by using <code>https://countryside.example.org</code> create the file <code>/etc/nginx/sites-enabled/countryside.example.org</code> (or symlink via <code>/etc/nginx/sites-available</code>) and add the following:</p>
<pre><code class="language-nginx">server {
    listen       443 ssl;
    server_name  countryside.example.org;
    
    ssl on;
    ssl_certificate /etc/nginx/ssl/countryside.example.org/countryside.example.org-bundle.crt;
    ssl_certificate_key /etc/nginx/ssl/countryside.example.org/countryside.example.org.key;
    ssl_prefer_server_ciphers on;

    location / {
        proxy_pass http://localhost:8124;
        proxy_set_header Host $host;
    }

    location /api/websocket {
        proxy_pass http://localhost:8124/api/websocket;
        proxy_set_header Host $host;

        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection &quot;upgrade&quot;;

    }
}
</code></pre>
<h4>HTTP to HTTPS redirection</h4>
<p>Add to your <code>/etc/nginx/sites-enabled/default</code></p>
<pre><code class="language-nginx">server {
    listen       80 default_server;
    server_name  example.tld;

    return 301 https://$host$request_uri;
}
</code></pre>
:ET