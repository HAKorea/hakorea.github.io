I"×<p>The <code>Azure Event Hub</code> integration allows you to hook into the Home Assistant event bus and send events to <a href="https://azure.microsoft.com/en-us/services/event-hubs/">Azure Event Hub</a> or to a <a href="https://docs.microsoft.com/en-us/azure/iot-hub/iot-hub-devguide-messages-read-builtin">Azure IoT Hub</a>.</p>
<h2>First time setup</h2>
<p>This assumes you already have a Azure account. Otherwise create a Free account <a href="https://azure.microsoft.com/en-us/free/">here</a>.</p>
<p>You need to create a Event Hub namespace and a Event Hub in that namespace, you can follow <a href="https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-create">this guide</a>. Alternatively you can directly deploy an ARM template with the namespace and the Event Hub <a href="https://github.com/Azure/azure-quickstart-templates/tree/master/201-event-hubs-create-event-hub-and-consumer-group/">from here</a>.</p>
<p>You must then create a Shared Access Policy for the Event Hub with â€˜Sendâ€™ claims or use the RootManageAccessKey from your namespace (this key has additional claims, including managing the event hub and listening, which are not needed for this purpose), for more details on the security of Event Hubs <a href="https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-authentication-and-security-model-overview">go here</a>.</p>
<p>Once you have the name of your namespace, instance, Shared Access Policy and the key for that policy, you can setup the integration itself.</p>
<h2>Configuration</h2>
<p>Add the following lines to your <code>configuration.yaml</code> file:</p>
<pre><code class="language-yaml"># Example configuration.yaml entry
azure_event_hub:
  event_hub_namespace: NAMESPACE_NAME
  event_hub_instance_name: EVENT_HUB_INSTANCE_NAME
  event_hub_sas_policy: SAS_POLICY_NAME
  event_hub_sas_key: SAS_KEY
  filter:
    include_domains:
    - homeassistant
    - light
    - media_player
</code></pre>
<div class="config-vars">
  <h3><a class="title-link" name="configuration-variables" href="#configuration-variables"></a> Configuration Variables</h3>
  <dl class=''><dt><a class='title-link' name='event_hub_namespace' href='#event_hub_namespace'></a> event_hub_namespace</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>The name of your Event Hub namespace.</p>
</span></p></dd><dt><a class='title-link' name='event_hub_instance_name' href='#event_hub_instance_name'></a> event_hub_instance_name</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>The name of your Event Hub instance.</p>
</span></p></dd><dt><a class='title-link' name='event_hub_sas_policy' href='#event_hub_sas_policy'></a> event_hub_sas_policy</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>The name of your Shared Access Policy.</p>
</span></p></dd><dt><a class='title-link' name='event_hub_sas_key' href='#event_hub_sas_key'></a> event_hub_sas_key</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>The key for the Shared Access Policy.</p>
</span></p></dd><dt><a class='title-link' name='filter' href='#filter'></a> filter</dt><dd><p class='desc'><span class='type'>(<span class='map'>map</span>)</span><span class='required'>(Required)</span><span class='description'><p>Filter domains and entities for Event Hub.</p>
</span></p><p class='default'>
Default value: <p>Includes all entities from all domains</p>
</p></dd><dd><dl class='nested'><dt><a class='title-link' name='include_domains' href='#include_domains'></a> include_domains</dt><dd><p class='desc'><span class='type'>(<span class='list'>list</span>)</span><span class='required'>(Optional)</span><span class='description'><p>List of domains to include (e.g., <code>light</code>).</p>
</span></p></dd><dt><a class='title-link' name='exclude_domains' href='#exclude_domains'></a> exclude_domains</dt><dd><p class='desc'><span class='type'>(<span class='list'>list</span>)</span><span class='required'>(Optional)</span><span class='description'><p>List of domains to exclude (e.g., <code>light</code>).</p>
</span></p></dd><dt><a class='title-link' name='include_entities' href='#include_entities'></a> include_entities</dt><dd><p class='desc'><span class='type'>(<span class='list'>list</span>)</span><span class='required'>(Optional)</span><span class='description'><p>List of entities to include (e.g., <code>light.attic</code>).</p>
</span></p></dd><dt><a class='title-link' name='exclude_entities' href='#exclude_entities'></a> exclude_entities</dt><dd><p class='desc'><span class='type'>(<span class='list'>list</span>)</span><span class='required'>(Optional)</span><span class='description'><p>List of entities to include (e.g., <code>light.attic</code>).</p>
</span></p></dd></dl></dd></dl>
</div>
<div class='note warning'>
Not filtering domains or entities will send every event to Azure Event Hub, thus taking up a lot of space. 
</div>
<div class='note warning'>
Event Hubs have a retention time of at most 7 days, if you do not capture or use the events they are deleted automatically from the Event Hub, the default retention is 1 day.
</div>
<h3>Using the data in Azure</h3>
<p>There are a number of ways to stream the data that comes into the Event Hub into storages in Azure, the easiest way is to use the built-in Capture function and this allows you to capture the data in Azure Blob Storage or Azure Data Lake store, <a href="https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-capture-overview">details here</a>.</p>
<p>Other storages in Azure (and outside) are possible with a <a href="https://docs.microsoft.com/en-us/azure/stream-analytics/stream-analytics-define-inputs#stream-data-from-event-hubs">Azure Stream Analytics job</a>, for instance for <a href="https://docs.microsoft.com/en-us/azure/stream-analytics/stream-analytics-documentdb-output">Cosmos DB</a>, <a href="https://docs.microsoft.com/en-us/azure/stream-analytics/stream-analytics-sql-output-perf">Azure SQL DB</a>, <a href="https://docs.microsoft.com/en-us/azure/stream-analytics/stream-analytics-define-outputs#table-storage">Azure Table Storage</a>, custom writing to <a href="https://docs.microsoft.com/en-us/azure/stream-analytics/stream-analytics-custom-path-patterns-blob-storage-output">Azure Blob Storage</a> and <a href="https://docs.microsoft.com/en-us/azure/stream-analytics/stream-analytics-quick-create-portal#configure-job-output">Topic and Queues</a>.</p>
<p>On the analytical side, Event Hub can be directly fed into <a href="https://docs.microsoft.com/en-us/azure/azure-databricks/databricks-stream-from-eventhubs?toc=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Fazure%2Fevent-hubs%2FTOC.json&amp;bc=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Fazure%2Fbread%2Ftoc.json">Azure Databricks Spark</a>, <a href="https://docs.microsoft.com/en-us/azure/time-series-insights/time-series-insights-how-to-add-an-event-source-eventhub">Azure Time Series Insights</a> and <a href="https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-tutorial-visualize-anomalies">Microsoft Power BI</a>.</p>
<p>The final way to use the data in Azure is to connect a Azure Function to the Event Hub using the <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-event-hubs">Event Hub trigger binding</a>.</p>
:ET