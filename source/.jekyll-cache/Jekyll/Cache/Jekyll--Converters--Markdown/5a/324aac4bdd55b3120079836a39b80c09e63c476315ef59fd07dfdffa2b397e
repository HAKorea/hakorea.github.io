I"æ	<p>Synology NAS are the perfect companion to running Home Assistant. But by default, the DSM Reverse Proxy does not configure its NGINX settings to allow WebSocket, and some extra configuration will be required to get the Home Assistant frontend working with the DSM.</p>
<h3>Setup headers</h3>
<p>Starting with DSM 6.2.1+, you can create ‚Äúcustom headers‚Äù in the Application Portal:</p>
<ul>
<li>Go to Application Portal and edit your entry</li>
<li>Click on ‚Äúcustom headers‚Äù tab and click the dropdon on the ‚ÄúCreate‚Äù button</li>
<li>Select ‚ÄúWebsocket‚Äù. This will automatically add the required headers for websocket to this reverse proxy.</li>
<li>Click ‚ÄúOK‚Äù. Home Assistant should work now with the reverse proxy.</li>
</ul>
<p>It‚Äôs not necessary anymore to change the template anymore since Version DSM 6.2.1. Changing the <code>Portal.mustache</code> is not recommended! You should use the following part only if you‚Äôre using a Version before DSM 6.2.1. on your Synology.</p>
<h3>Template change</h3>
<p>To allow WebSocket by default for all service exposed by NGINX, you can enable it in the template file located in <code>/usr/syno/share/nginx/Portal.mustache</code>. Please be really careful in editing this file since you may break access to the DSM UI. Please backup this file before any edition.</p>
<p>Open <code>/usr/syno/share/nginx/Portal.mustache</code> and add the followings in the <code>Location</code> section:</p>
<pre><code class="language-text">        proxy_set_header        Upgrade             $http_upgrade;
        proxy_set_header        Connection          &quot;upgrade&quot;;
        proxy_read_timeout      86400;
</code></pre>
<p>Then restart the NGINX daemon:</p>
<pre><code class="language-bash">sudo synoservicecfg --restart nginx
</code></pre>
<p>This will restart the running HTTP service, not only reverse proxy, as a single instance of NGINX runs everything.</p>
<p>You can find more information <a href="https://github.com/orobardet/dsm-reverse-proxy-websocket">here</a>.</p>
<h4>HTTP Configuration</h4>
<ul>
<li>Copy the Home Assistant specific Reverse Proxy settings from the existing <code>/etc/nginx/app.d/server.ReverseProxy.conf</code> file to <code>/usr/local/etc/nginx/conf.d/http.HomeAssistant.conf</code>.</li>
<li>Include these lines in the location declaration:</li>
</ul>
<pre><code class="language-text">    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection &quot;upgrade&quot;;
</code></pre>
:ET