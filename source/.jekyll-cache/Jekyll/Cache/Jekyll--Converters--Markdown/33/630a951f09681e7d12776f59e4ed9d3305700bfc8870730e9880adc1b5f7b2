I"0S<p><a href="https://www.dresden-elektronik.de/funk/software/deconz.html">deCONZ</a> by <a href="https://www.dresden-elektronik.de">dresden elektronik</a> is a software that communicates with ConBee/RaspBee Zigbee gateways and exposes Zigbee devices that are connected to the gateway.</p>
<p><a href="https://dresden-elektronik.github.io/deconz-rest-doc/">deCONZ REST API</a>.</p>
<p>There is currently support for the following device types within Home Assistant:</p>
<ul>
<li><a href="#binary-sensor">Binary Sensor</a></li>
<li><a href="#climate">Climate</a></li>
<li><a href="#cover">Cover</a></li>
<li><a href="#light">Light</a></li>
<li><a href="#scene">Scene</a></li>
<li><a href="#sensor">Sensor</a></li>
<li><a href="#switch">Switch</a></li>
</ul>
<h2>Recommended way of running deCONZ</h2>
<p>If you are running Hass.io, an official add-on for deCONZ is available in the add-on store.
Otherwise, use <a href="https://hub.docker.com/r/marthoc/deconz/">community container</a> by Marthoc for your deCONZ needs.</p>
<h3>Supported devices</h3>
<p>See <a href="https://github.com/dresden-elektronik/deconz-rest-plugin/wiki/Supported-Devices">deCONZ wiki</a> for a list of supported devices.</p>
<h2>Configuration</h2>
<p>Home Assistant will automatically discover deCONZ presence on your network, if <code>discovery:</code> is present in your <code>configuration.yaml</code> file.</p>
<p>If you don’t have the API key, you can generate an API key for deCONZ by using the one-click functionality similar to Philips Hue. Go to <strong>Settings</strong> → <strong>Gateway</strong> → <strong>Advanced</strong> → <strong>Authenticate app</strong> in the Phoscon App and then use the deCONZ configurator in Home Assistant frontend to create an API key. When you’re done setting up deCONZ it will be stored as a config entry.</p>
<p>You can manually add deCONZ by going to the integrations page.</p>
<h2>Debugging integration</h2>
<p>If you have problems with deCONZ or the integration you can add debug prints to the log.</p>
<pre><code class="language-yaml">logger:
  default: info
  logs:
    pydeconz: debug
    homeassistant.components.deconz: debug
</code></pre>
<h2>Troubleshooting</h2>
<p>If you are having issues and want to report a problem, always start with making sure that you’re on the latest <a href="https://github.com/dresden-elektronik/deconz-rest-plugin/releases">deCONZ software version</a> and <a href="http://deconz.dresden-elektronik.de/deconz-firmware/?C=M;O=D">latest firmware for hardware</a>.</p>
<h2>Device services</h2>
<p>Available services: <code>configure</code> and <code>deconz.device_refresh</code>.</p>
<h3>Service <code>deconz.configure</code></h3>
<p>Set attribute of device in deCONZ using <a href="https://dresden-elektronik.github.io/deconz-rest-doc/rest/">REST-API</a>.</p>
<table>
<thead>
<tr>
<th>Service data attribute</th>
<th>Optional</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>field</code></td>
<td>No</td>
<td>String representing a specific device in deCONZ.</td>
</tr>
<tr>
<td><code>entity</code></td>
<td>No</td>
<td>String representing a specific Home Assistant entity of a device in deCONZ.</td>
</tr>
<tr>
<td><code>data</code></td>
<td>No</td>
<td>Data is a JSON object with what data you want to alter.</td>
</tr>
</tbody>
</table>
<p>Either <code>entity</code> or <code>field</code> must be provided. If both are present, <code>field</code> will be interpreted as a subpath under the device path corresponding to the specified <code>entity</code>:</p>
<pre><code class="language-json">{ &quot;field&quot;: &quot;/lights/1&quot;, &quot;data&quot;: {&quot;name&quot;: &quot;light2&quot;} }
</code></pre>
<pre><code class="language-json">{ &quot;entity&quot;: &quot;light.light1&quot;, &quot;data&quot;: {&quot;name&quot;: &quot;light2&quot;} }
</code></pre>
<pre><code class="language-json">{ &quot;entity&quot;: &quot;light.light1&quot;, &quot;field: &quot;/state&quot;, &quot;data&quot;: {&quot;on&quot;: true} }
</code></pre>
<pre><code class="language-json">{ &quot;field&quot;: &quot;/config&quot;, &quot;data&quot;: {&quot;permitjoin&quot;: 60} }
</code></pre>
<h4>Service <code>deconz.device_refresh</code></h4>
<p>Refresh with devices added to deCONZ after Home Assistants latest restart.</p>
<p>Note: deCONZ automatically signals Home Assistant when new sensors are added, but other devices must at this point in time (deCONZ v2.05.35) be added manually using this service or a restart of Home Assistant.</p>
<h2>Remote control devices</h2>
<p>Remote controls (ZHASwitch category) will not be exposed as regular entities, but as events named <code>deconz_event</code> with a payload of <code>id</code> and <code>event</code> and in case of the Aqara Magic Cube also <code>gesture</code>. Id will be the device name from deCONZ and Event will be the momentary state of the switch. Gesture is used for some Aqara Magic Cube specific events like: flip 90 degrees, flip 180 degrees, clockwise and counter clockwise rotation. However, a sensor entity will be created that shows the battery level of the switch as reported by deCONZ, named sensor.device_name_battery_level.</p>
<p>Typical values for switches, the event codes are 4 numbers where the first and last number are of interest here.</p>
<table>
<thead>
<tr>
<th>Switch code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1XXX</td>
<td>Button #1 up to #8</td>
</tr>
<tr>
<td>XXX1</td>
<td>Button hold</td>
</tr>
<tr>
<td>XXX2</td>
<td>Button short release</td>
</tr>
<tr>
<td>XXX3</td>
<td>Button long release</td>
</tr>
</tbody>
</table>
<p>Where for example on a Philips Hue Dimmer, 2001 would be holding the dim up button.</p>
<p>For the IKEA Tradfri remote the first digit equals, 1 for the middle button, 2 for up, 3 for down, 4 for left, and 5 for right (e.g., “event: 1002” for middle button short release).</p>
<p>Specific gestures for the Aqara Magic Cube are:</p>
<table>
<thead>
<tr>
<th>Gesture</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Awake</td>
</tr>
<tr>
<td>1</td>
<td>Shake</td>
</tr>
<tr>
<td>2</td>
<td>Free fall</td>
</tr>
<tr>
<td>3</td>
<td>Flip 90</td>
</tr>
<tr>
<td>4</td>
<td>Flip 180</td>
</tr>
<tr>
<td>5</td>
<td>Move on any side</td>
</tr>
<tr>
<td>6</td>
<td>Double tap on any side</td>
</tr>
<tr>
<td>7</td>
<td>Turn clockwise</td>
</tr>
<tr>
<td>8</td>
<td>Turn counter clockwise</td>
</tr>
</tbody>
</table>
<h3>Finding your events</h3>
<p>Navigate to <strong>Developer tools-&gt;Events</strong>. In the section <strong>Listen to events</strong> add <code>deconz_event</code> and press <strong>START LISTENING</strong>. All events from deCONZ will now be shown and by pushing your remote button while monitoring the log it should be fairly easy to find the events you are looking for.</p>
<h3>Device triggers</h3>
<p>To simplify using remote control devices in automations deCONZ integration exposes them as device triggers. This will expose all possible variations of button presses and rotations. Note that this is a manually curated list and will not initially be as complete as what deCONZ supports.</p>
<p>Currently supported devices as device triggers:</p>
<ul>
<li>Hue Dimmer Remote</li>
<li>Hue Tap</li>
<li>Symfonisk Sound Controller</li>
<li>Trådfri On/Off Switch</li>
<li>Trådfri Open/Close Remote</li>
<li>Trådfri Remote Control</li>
<li>Trådfri Wireless Dimmer</li>
<li>Aqara Double Wall Switch</li>
<li>Aqara Mini Switch</li>
<li>Aqara Round Switch</li>
<li>Aqara Square Switch</li>
<li>Aqara Magic Cube</li>
</ul>
<h4>Requesting support for new device trigger</h4>
<p>Requesting support for additional devices requires the device model (can be acquired from debug logs) together with a mapping of action and button event, e.g., Hue dimmer remote model “RWL021”, Short press turn on 1000.</p>
<h2>Examples</h2>
<h3>YAML</h3>
<h4>Step up and step down input number with wireless dimmer</h4>
<pre><code class="language-yaml">automation:
  - alias: 'Toggle lamp from dimmer'
    initial_state: 'on'
    trigger:
      platform: event
      event_type: deconz_event
      event_data:
        id: remote_control_1
        event: 1002
    action:
      service: light.toggle
      entity_id: light.lamp

  - alias: 'Increase brightness of lamp from dimmer'
    initial_state: 'on'
    trigger:
      platform: event
      event_type: deconz_event
      event_data:
        id: remote_control_1
        event: 2002
    action:
      - service: light.turn_on
        data_template:
          entity_id: light.lamp
          brightness: &gt;
            {% set bri = state_attr('light.lamp', 'brightness') | int %}
            {{ [bri+30, 249] | min }}

  - alias: 'Decrease brightness of lamp from dimmer'
    initial_state: 'on'
    trigger:
      platform: event
      event_type: deconz_event
      event_data:
        id: remote_control_1
        event: 3002
    action:
      - service: light.turn_on
        data_template:
          entity_id: light.lamp
          brightness: &gt;
            {% set bri = state_attr('light.lamp', 'brightness') | int %}
            {{ [bri-30, 0] | max }}

  - alias: 'Turn lamp on when turning cube clockwise'
    initial_state: 'on'
    trigger:
      platform: event
      event_type: deconz_event
      event_data:
        id: remote_control_1
        gesture: 7
    action:
      service: light.turn_on
      entity_id: light.lamp
</code></pre>
<h3>Appdaemon</h3>
<h4>Appdaemon event helper</h4>
<p>Helper app that creates a sensor <code>sensor.deconz_event</code> with a state that represents the id from the last event and an attribute to show the event data.</p>
<p>Put this in <code>apps.yaml</code>:</p>
<pre><code class="language-yaml">deconz_helper:
  module: deconz_helper
  class: DeconzHelper
</code></pre>
<p>Put this in <code>deconz_helper.py</code>:</p>
<pre><code class="language-python">import appdaemon.plugins.hass.hassapi as hass
import datetime
from datetime import datetime


class DeconzHelper(hass.Hass):
    def initialize(self) -&gt; None:
        self.listen_event(self.event_received, &quot;deconz_event&quot;)

    def event_received(self, event_name, data, kwargs):
        event_data = data[&quot;event&quot;]
        event_id = data[&quot;id&quot;]
        event_received = datetime.now()

        self.log(f&quot;Deconz event received from {event_id}. Event was: {event_data}&quot;)
        self.set_state(
            &quot;sensor.deconz_event&quot;,
            state=event_id,
            attributes={
                &quot;event_data&quot;: event_data,
                &quot;event_received&quot;: str(event_received),
            },
        )
</code></pre>
<p>Note: the event will not be visible before one event gets sent.</p>
<h4>Appdaemon remote template</h4>
<pre><code class="language-yaml">remote_control:
  module: remote_control
  class: RemoteControl
  event: deconz_event
  id: dimmer_switch_1
</code></pre>
<pre><code class="language-python">import appdaemon.plugins.hass.hassapi as hass


class RemoteControl(hass.Hass):
    def initialize(self):
        if &quot;event&quot; in self.args:
            self.listen_event(self.handle_event, self.args[&quot;event&quot;])

    def handle_event(self, event_name, data, kwargs):
        if data[&quot;id&quot;] == self.args[&quot;id&quot;]:
            self.log(data[&quot;event&quot;])
            if data[&quot;event&quot;] == 1002:
                self.log(&quot;Button on&quot;)
            elif data[&quot;event&quot;] == 2002:
                self.log(&quot;Button dim up&quot;)
            elif data[&quot;event&quot;] == 3002:
                self.log(&quot;Button dim down&quot;)
            elif data[&quot;event&quot;] == 4002:
                self.log(&quot;Button off&quot;)
</code></pre>
<h4>Appdaemon remote template</h4>
<p>Community app from <a href="https://community.home-assistant.io/u/teachingbirds/summary">Teachingbirds</a>. This app uses an Ikea Tradfri remote to control Sonos speakers with play/pause, volume up and down, next and previous track.</p>
<pre><code class="language-yaml">sonos_remote_control:
  module: sonos_remote
  class: SonosRemote
  event: deconz_event
  id: sonos_remote
  sonos: media_player.sonos
</code></pre>
<pre><code class="language-python">import appdaemon.plugins.hass.hassapi as hass


class SonosRemote(hass.Hass):
    def initialize(self):
        self.sonos = self.args[&quot;sonos&quot;]
        if &quot;event&quot; in self.args:
            self.listen_event(self.handle_event, self.args[&quot;event&quot;])

    def handle_event(self, event_name, data, kwargs):
        if data[&quot;id&quot;] == self.args[&quot;id&quot;]:
            if data[&quot;event&quot;] == 1002:
                self.log(&quot;Button toggle&quot;)
                self.call_service(&quot;media_player/media_play_pause&quot;, entity_id=self.sonos)

            elif data[&quot;event&quot;] == 2002:
                self.log(&quot;Button volume up&quot;)
                self.call_service(&quot;media_player/volume_up&quot;, entity_id=self.sonos)

            elif data[&quot;event&quot;] == 3002:
                self.log(&quot;Button volume down&quot;)
                self.call_service(&quot;media_player/volume_down&quot;, entity_id=self.sonos)

            elif data[&quot;event&quot;] == 4002:
                self.log(&quot;Button previous&quot;)
                self.call_service(
                    &quot;media_player/media_previous_track&quot;, entity_id=self.sonos
                )

            elif data[&quot;event&quot;] == 5002:
                self.log(&quot;Button next&quot;)
                self.call_service(&quot;media_player/media_next_track&quot;, entity_id=self.sonos)
</code></pre>
<h2>Binary Sensor</h2>
<p>The following sensor types are supported:</p>
<ul>
<li>Fire/Smoke detection</li>
<li>Open/Close detection</li>
<li>Presence detection</li>
<li>Water leakage detection</li>
</ul>
<p>The <code>entity_id</code> name will be <code>binary_sensor.device_name</code>, where <code>device_name</code> is defined in deCONZ.</p>
<h3>Verified supported binary sensors</h3>
<ul>
<li>Open/Close Detection
<ul>
<li>Xiaomi Smart Home Security Door &amp; Window Contact Sensor</li>
</ul>
</li>
<li>Presence Detection
<ul>
<li>IKEA Trådfri Motion Sensor</li>
<li>Philips Hue Motion Sensor</li>
<li>Xiaomi Motion Sensor</li>
<li>Xiaomi Smart Home Aqara Human Body Sensor</li>
</ul>
</li>
<li>Water leakage detection
<ul>
<li>Xiaomi Aqara water leak Sensor</li>
</ul>
</li>
</ul>
<h2>Climate</h2>
<p>See the <a href="/integrations/deconz/">deCONZ main integration</a> for configuration instructions.</p>
<p>Climate currently represent thermostats.</p>
<p>Note that devices in the climate platform identify as sensors, so there is a manually curated list that defines which “sensors” are climate devices.</p>
<p>The <code>entity_id</code> name will be <code>climate.device_name</code>, where <code>device_name</code> is defined in deCONZ.</p>
<h4>Verified supported climate devices</h4>
<ul>
<li>Bitron Thermostat 902010/32</li>
<li>Eurotronic SPZB0001</li>
</ul>
<h2>Cover</h2>
<p>Covers are devices like ventilation dampers or smart window covers.</p>
<p>Note that devices in the cover platform identify as lights, so there is a manually curated list that defines which “lights” are covers. You therefore add a cover device as a light device in deCONZ (Phoscon App).</p>
<p>The <code>entity_id</code> name will be <code>cover.device_name</code>, where <code>device_name</code> is defined in deCONZ.</p>
<h3>Verified supported covers</h3>
<ul>
<li>Keen vents</li>
<li>Xiaomi Aqara Curtain controller</li>
</ul>
<h2>Light</h2>
<p>The <code>entity_id</code> names will be <code>light.device_name</code>, where <code>device_name</code> is defined in deCONZ. Light groups created in deCONZ will be created in Home Assistant as lights named <code>light.group_name_in_deconz</code>, allowing the user to control groups of lights with only a single API call to deCONZ.</p>
<h3>Verified supported lights</h3>
<ul>
<li>IKEA Trådfri bulb E14 WS Opal 400lm</li>
<li>IKEA Trådfri bulb E14 WS Opal 600lm</li>
<li>IKEA Trådfri bulb E27 WS clear 806lm</li>
<li>IKEA Trådfri bulb E27 WS clear 950lm</li>
<li>IKEA Trådfri bulb E27 WS Opal 980lm</li>
<li>IKEA Trådfri bulb E27 WS Opal 1000lm</li>
<li>IKEA Trådfri bulb E27 WS &amp; RGB Opal 600lm</li>
<li>IKEA Trådfri bulb GU10 W 400lm</li>
<li>IKEA Trådfri FLOALT LED light panel</li>
<li>Innr BY-265, BY-245</li>
<li>OSRAM Classic A60 W clear - LIGHTIFY</li>
<li>OSRAM Flex RGBW</li>
<li>OSRAM Gardenpole RGBW</li>
<li>Philips Hue White A19</li>
<li>Philips Hue White Ambiance A19</li>
<li>Philips Hue Hue White ambiance Milliskin (recessed spotlight) LTW013</li>
<li>Philips Hue LightStrip Plus</li>
<li>Busch Jaeger ZigBee Light Link univ. relai (6711 U) with ZigBee Light Link control element 6735-84</li>
<li>Xiaomi Aqara Smart Led Bulb (white) E27 ZNLDP12LM</li>
</ul>
<h2>Scene</h2>
<p>The <code>entity_id</code> name will be <code>scene.group_scene_name</code>, where <code>group</code> is which group the scene belongs to and the name of the scene, both group and name are defined in deCONZ.</p>
<h2>Sensor</h2>
<p>The following sensor types are supported:</p>
<ul>
<li>Humidity sensor</li>
<li>Light level sensor</li>
<li>Pressure sensor</li>
<li>Switches</li>
<li>Temperature sensor</li>
</ul>
<p>The <code>entity_id</code> name will be <code>sensor.device_name</code>, where <code>device_name</code> is defined in deCONZ. Switches aren’t exposed as ordinary entities, see the <a href="/integrations/deconz/">deCONZ main integration</a> for more details.</p>
<h3>Verified to be supported sensors</h3>
<ul>
<li>Humidity Sensor
<ul>
<li>Xiaomi Aqara Humidity/Temperature Sensor</li>
<li>Xiaomi MiJia Smart Temperature &amp; Humidity Sensor</li>
</ul>
</li>
<li>Light Level Sensor</li>
<li>Pressure Sensor</li>
<li>Switches
<ul>
<li>IKEA Trådfri Wireless Dimmer</li>
<li>Philips Hue Motion Sensor</li>
<li>IKEA Trådfri Remote</li>
<li>Philips Hue Dimmer Switch</li>
<li>Xiaomi Aqara Smart Light Switch</li>
<li>Xiaomi Aqara Smart Wireless Switch</li>
<li>Xiaomi Smart Home Wireless Switch</li>
</ul>
</li>
<li>Temperature Sensor
<ul>
<li>Xiaomi Temperature/Humidity Sensor</li>
</ul>
</li>
<li>OpenClose Sensor
<ul>
<li>Xiaomi Window / Door Sensor with Temperature</li>
</ul>
</li>
</ul>
<h3>deCONZ Daylight Sensor</h3>
<p>The deCONZ Daylight sensor is a special sensor built into the deCONZ software since version 2.05.12. It is represented in Home Assistant as a sensor called sensor.daylight. The sensor’s state value is a string corresponding to the phase of daylight (descriptions below taken from <a href="https://github.com/mourner/suncalc">https://github.com/mourner/suncalc</a>, on which the deCONZ implementation is based):</p>
<table>
<thead>
<tr>
<th>Sensor State</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>sunrise_start</td>
<td>sunrise (top edge of the sun appears on the horizon)</td>
</tr>
<tr>
<td>sunrise_end</td>
<td>sunrise ends (bottom edge of the sun touches the horizon)</td>
</tr>
<tr>
<td>golden_hour_1</td>
<td>morning golden hour (soft light, the best time for photography)</td>
</tr>
<tr>
<td>solar_noon</td>
<td>solar noon (sun is in the highest position)</td>
</tr>
<tr>
<td>golden_hour_2</td>
<td>evening golden hour</td>
</tr>
<tr>
<td>sunset_start</td>
<td>sunset starts (bottom edge of the sun touches the horizon)</td>
</tr>
<tr>
<td>sunset_end</td>
<td>sunset (sun disappears below the horizon, evening civil twilight starts)</td>
</tr>
<tr>
<td>dusk</td>
<td>dusk (evening nautical twilight starts)</td>
</tr>
<tr>
<td>nautical_dusk</td>
<td>nautical dusk (evening astronomical twilight starts)</td>
</tr>
<tr>
<td>night_start</td>
<td>night starts (dark enough for astronomical observations)</td>
</tr>
<tr>
<td>nadir</td>
<td>nadir (darkest moment of the night, the sun is in the lowest position)</td>
</tr>
<tr>
<td>night_end</td>
<td>night ends (morning astronomical twilight starts)</td>
</tr>
<tr>
<td>nautical_dawn</td>
<td>nautical dawn (morning nautical twilight starts)</td>
</tr>
<tr>
<td>dawn</td>
<td>dawn (morning nautical twilight ends, morning civil twilight starts)</td>
</tr>
</tbody>
</table>
<p>The sensor also has an attribute called “daylight” that has the value <code>true</code> when the sensor’s state is <code>golden_hour_1</code>, <code>solar_noon</code>, or <code>golden_hour_2</code>, and <code>false</code> otherwise.</p>
<p>These states can be used in automations as a trigger (e.g., trigger when a certain phase of daylight starts or ends) or condition (e.g., trigger only if in a certain phase of daylight).</p>
<h2>Switch</h2>
<p>Switches are devices like power plugs and sirens.</p>
<p>Note that devices in the switch platform identify as lights, so there is a manually curated list that defines which “lights” are switches.</p>
<p>The <code>entity_id</code> name will be <code>switch.device_name</code>, where <code>device_name</code> is defined in deCONZ.</p>
<h3>Verified supported switches</h3>
<ul>
<li>Innr SP120</li>
<li>Innr ZB-ONOFFPlug-D0005/SmartThings Smart Plug (2019) (without power measurements)</li>
<li>Osram Lightify plug</li>
<li>Osram Outdoor plug</li>
<li>Heiman siren</li>
</ul>
:ET