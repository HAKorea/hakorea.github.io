I"¯<p>The <code>tplink</code> integration allows you to control your <a href="https://www.tp-link.com/kasa-smart/">TP-Link Smart Home Devices</a> such as smart plugs and smart bulbs.</p>
<p>There is currently support for the following device types within Home Assistant:</p>
<ul>
<li><strong>Light</strong></li>
<li><strong>Switch</strong></li>
</ul>
<p>In order to activate the support, you will have to enable the integration inside the config panel.
The supported devices in your network are automatically discovered, but if you want to control devices residing in other networks you will need to configure them manually as shown below.</p>
<h2>Supported Devices</h2>
<p>This integration supports devices that are controllable with the <a href="https://www.tp-link.com/us/kasa-smart/kasa.html">KASA app</a>.
The following devices are known to work with this component.</p>
<h3>Plugs</h3>
<ul>
<li>HS100</li>
<li>HS103</li>
<li>HS105</li>
<li>HS110 (The only device capable or reporting energy usage data to template sensors)</li>
</ul>
<h3>Strip (Multi-Plug)</h3>
<ul>
<li>HS107 (indoor 2-outlet)</li>
<li>HS300 (powerstrip 6-outlet)</li>
<li>KP303 (powerstrip 3-outlet)</li>
<li>KP400 (outdoor 2-outlet)</li>
<li>KP200 (indoor 2-outlet)</li>
</ul>
<h3>Wall Switches</h3>
<ul>
<li>HS200</li>
<li>HS210</li>
<li>HS220 (acts as a light)</li>
</ul>
<h3>Bulbs</h3>
<ul>
<li>LB100</li>
<li>LB110</li>
<li>LB120</li>
<li>LB130</li>
<li>LB230</li>
<li>KL110</li>
<li>KL120</li>
<li>KL130</li>
</ul>
<h2>Configuration</h2>
<pre><code class="language-yaml"># Example configuration.yaml
tplink:
</code></pre>
<div class="config-vars">
  <h3><a class="title-link" name="configuration-variables" href="#configuration-variables"></a> Configuration Variables</h3>
  <dl class=''><dt><a class='title-link' name='discovery' href='#discovery'></a> discovery</dt><dd><p class='desc'><span class='type'>(<span class='boolean'>boolean</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Whether to do automatic discovery of devices.</p>
</span></p><p class='default'>
Default value: <p>true</p>
</p></dd><dt><a class='title-link' name='light' href='#light'></a> light</dt><dd><p class='desc'><span class='type'>(<span class='list'>list</span>)</span><span class='required'>(Optional)</span><span class='description'><p>List of light devices.</p>
</span></p></dd><dd><dl class='nested'><dt><a class='title-link' name='host' href='#host'></a> host</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>Hostname or IP address of the device.</p>
</span></p></dd></dl></dd><dt><a class='title-link' name='strip' href='#strip'></a> strip</dt><dd><p class='desc'><span class='type'>(<span class='list'>list</span>)</span><span class='required'>(Optional)</span><span class='description'><p>List of multi-outlet on/off switch devices.</p>
</span></p></dd><dd><dl class='nested'><dt><a class='title-link' name='host' href='#host'></a> host</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>Hostname or IP address of the device.</p>
</span></p></dd></dl></dd><dt><a class='title-link' name='switch' href='#switch'></a> switch</dt><dd><p class='desc'><span class='type'>(<span class='list'>list</span>)</span><span class='required'>(Optional)</span><span class='description'><p>List of on/off switch devices.</p>
</span></p></dd><dd><dl class='nested'><dt><a class='title-link' name='host' href='#host'></a> host</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>Hostname or IP address of the device.</p>
</span></p></dd></dl></dd><dt><a class='title-link' name='dimmer' href='#dimmer'></a> dimmer</dt><dd><p class='desc'><span class='type'>(<span class='list'>list</span>)</span><span class='required'>(Optional)</span><span class='description'><p>List of dimmable switch devices.</p>
</span></p></dd><dd><dl class='nested'><dt><a class='title-link' name='host' href='#host'></a> host</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>Hostname or IP address of the device.</p>
</span></p></dd></dl></dd></dl>
</div>
<h2>Manual configuration example</h2>
<pre><code class="language-yaml"># Example configuration.yaml entry with manually specified addresses
tplink:
  discovery: false
  light:
    - host: 192.168.200.1
    - host: 192.168.200.2
  switch:
    - host: 192.168.200.3
    - host: 192.168.200.4
  dimmer:
    - host: 192.168.200.5
    - host: 192.168.200.6
  strip:
    - host: 192.168.200.7
    - host: 192.168.200.8
</code></pre>
<h2>Extracting Energy Sensor data</h2>
<p>In order to get the power consumption readings from a TP-Link HS110 device, youâ€™ll have to create a <a href="/integrations/switch.template/">template sensor</a>.
In the example below, change all of the <code>my_tp_switch</code>â€˜s to match your deviceâ€™s entity ID.</p>
<pre><code class="language-yaml">sensor:
  - platform: template
    sensors:
      my_tp_switch_amps:
        friendly_name_template: &quot;{{ states.switch.my_tp_switch.name}} Current&quot;
        value_template: '{{ states.switch.my_tp_switch.attributes[&quot;current_a&quot;] | float }}'
        unit_of_measurement: 'A'
      my_tp_switch_watts:
        friendly_name_template: &quot;{{ states.switch.my_tp_switch.name}} Current Consumption&quot;
        value_template: '{{ states.switch.my_tp_switch.attributes[&quot;current_power_w&quot;] | float }}'
        unit_of_measurement: 'W'
      my_tp_switch_total_kwh:
        friendly_name_template: &quot;{{ states.switch.my_tp_switch.name}} Total Consumption&quot;
        value_template: '{{ states.switch.my_tp_switch.attributes[&quot;total_energy_kwh&quot;] | float }}'
        unit_of_measurement: 'kWh'
      my_tp_switch_volts:
        friendly_name_template: &quot;{{ states.switch.my_tp_switch.name}} Voltage&quot;
        value_template: '{{ states.switch.my_tp_switch.attributes[&quot;voltage&quot;] | float }}'
        unit_of_measurement: 'V'
      my_tp_switch_today_kwh:
        friendly_name_template: &quot;{{ states.switch.my_tp_switch.name}} Today's Consumption&quot;
        value_template: '{{ states.switch.my_tp_switch.attributes[&quot;today_energy_kwh&quot;] | float }}'
        unit_of_measurement: 'kWh'
</code></pre>
:ET