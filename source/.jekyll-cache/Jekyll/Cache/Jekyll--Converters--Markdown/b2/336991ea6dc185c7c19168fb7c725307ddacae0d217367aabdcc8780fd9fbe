I"j<p>The <code>Azure Service Bus</code> integration allows you to send messages to <a href="https://azure.microsoft.com/en-us/services/service-bus/">Azure Service Bus</a> from within Home Assistant.</p>
<h2>First-time setup</h2>
<p>This assumes you already have an Azure account. Otherwise, create a free account <a href="https://azure.microsoft.com/en-us/free/">here</a>.</p>
<p>You need to create a Service Bus namespace; you can follow <a href="https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-create-namespace-portal">this guide</a>.</p>
<p>You must then create a Shared Access Policy for the Service Bus with <code>Send</code> claims or use the RootManageAccessKey from your namespace (this key has additional claims, including managing the event hub and listening, which are not needed for this purpose), for more details on the security of Service Bus <a href="https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-authentication-and-authorization#shared-access-signature">go here</a>. Alternatively you can create a dedicated key for only one queue or topic, to restrict access to only that queue or topic.</p>
<p>Once you have the connection string with <code>Send</code> policy, you can set up the integration itself.</p>
<div class='note warning'>
<p>The queue or topic that you are sending to needs to exists with the service bus namespace before you use it within Home Assistant. See <a href="https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-quickstart-portal">here</a> for how to set up a queue and <a href="https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-quickstart-topics-subscriptions-portal">here</a> for setting up a topic and subscriptions.</p>
</div>
<h2>Configuration</h2>
<p>Add the following lines to your <code>configuration.yaml</code> file:</p>
<pre><code class="language-yaml"># Example configuration.yaml entry
notify:
  - platform: azure_service_bus
    connection_string: !secret servicebus_connection_string
    topic: t-test
  - platform: azure_service_bus
    connection_string: !secret servicebus_connection_string
    queue: q-test
</code></pre>
<div class="config-vars">
  <h3><a class="title-link" name="configuration-variables" href="#configuration-variables"></a> Configuration Variables</h3>
  <dl class=''><dt><a class='title-link' name='name' href='#name'></a> name</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Setting the optional parameter <code>name</code> allows multiple notifiers to be created. The notifier will bind to the service <code>notify.NOTIFIER_NAME</code>.</p>
</span></p><p class='default'>
Default value: <p>notify</p>
</p></dd><dt><a class='title-link' name='connection_string' href='#connection_string'></a> connection_string</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>Connection string found in the Azure portal, with <code>send</code> claim in the key.</p>
</span></p></dd><dt><a class='title-link' name='queue' href='#queue'></a> queue</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Exclusive)</span><span class='description'><p>Which queue to send notifications on.</p>
</span></p></dd><dt><a class='title-link' name='topic' href='#topic'></a> topic</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Exclusive)</span><span class='description'><p>Which topic to send notifications on.</p>
</span></p></dd></dl>
</div>
<div class="note">
<p>If you plan to send all state changes from one or more entities within Home Assistant, you should consider using the <a href="/integrations/azure_event_hub/">Azure Event Hub</a> integration instead.</p>
</div>
<h2>Usage</h2>
<p>The notification service will translate the data given to a JSON object on the service bus. The <code>message</code> field will always be set, but the fields <code>target</code> and <code>title</code> are optional and are only included in the service bus message if set. Any input given in the <code>data</code> section, will be flattened to the root of the JSON object and follow the structure given. All input given in the data section will be included in the message.</p>
<p>See the example below for how an automation trigger translates to a message on the service bus.</p>
<pre><code class="language-yaml">automation:
  - alias: Sunset Service Bus message
    trigger:
      platform: sun
      event: sunset
    action:
      service: notify.test_queue
      data:
        message: &quot;Sun is going down&quot;
        title: &quot;Good evening&quot;
        data:
          sun_direction: &quot;Down&quot;
          custom_field: 123
          custom_object:
            trigger_more: true
            explain: &quot;Its starting to get dark&quot;
</code></pre>
<p>The message that can be retrieved from a queue or topic subscription:</p>
<pre><code class="language-json">{
  &quot;message&quot;: &quot;Sun is going down&quot;,
  &quot;title&quot;: &quot;Good evening&quot;,
  &quot;sun_direction&quot;: &quot;Down&quot;,
  &quot;custom_field&quot;: 123,
  &quot;custom_object&quot;: {
    &quot;trigger_more&quot;: true,
    &quot;explain&quot;: &quot;Its starting to get dark&quot;
  }
}
</code></pre>
:ET