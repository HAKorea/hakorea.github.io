I";<p>The <code>fritzbox_callmonitor</code> sensor monitors the call monitor exposed by <a href="https://avm.de/produkte/fritzbox/">AVM Fritz!Box</a> routers on TCP port 1012. It will assume the values <code>idle</code>, <code>ringing</code>, <code>dialing</code> or <code>talking</code> with the phone numbers involved contained in the state attributes.
It can also access the internal phone book of the router to look up the names corresponding to the phone numbers and store them in the state attributes.</p>
<h2>Setup</h2>
<p>To activate the call monitor on your Fritz!Box, dial #96*5* from any phone connected to it.</p>
<h2>Configuration</h2>
<p>To use the Fritz!Box call monitor in your installation, add the following to your <code>configuration.yaml</code> file:</p>
<pre><code class="language-yaml"># Example configuration.yaml entry
sensor:
  - platform: fritzbox_callmonitor
</code></pre>
<div class="config-vars">
  <h3><a class="title-link" name="configuration-variables" href="#configuration-variables"></a> Configuration Variables</h3>
  <dl class=''><dt><a class='title-link' name='name' href='#name'></a> name</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Give the sensor a friendly name for in the front-end.</p>
</span></p><p class='default'>
Default value: <p>Phone</p>
</p></dd><dt><a class='title-link' name='host' href='#host'></a> host</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>The IP address of your router, e.g., 192.168.1.1. It is optional since every FRITZ!Box is also reachable by using the IP address 169.254.1.1. If you have a local DNS server and have assigned a hostname to your FRITZ!Box, you can also use that here instead of the IP address.</p>
</span></p><p class='default'>
Default value: <p>169.254.1.1</p>
</p></dd><dt><a class='title-link' name='port' href='#port'></a> port</dt><dd><p class='desc'><span class='type'>(<span class='integer'>integer</span>)</span><span class='required'>(Optional)</span><span class='description'><p>The TCP port of the call monitor. There is usually no reason to change this.</p>
</span></p><p class='default'>
Default value: <p>1012</p>
</p></dd><dt><a class='title-link' name='username' href='#username'></a> username</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Fritz!Box user’s user name. This is required to use the phone book lookup feature. The user needs to have the “voice message, fax message, Fritz!App Fon and call list” permission.</p>
</span></p></dd><dt><a class='title-link' name='password' href='#password'></a> password</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Fritz!Box user’s user password. This is required to use the phone book lookup feature.</p>
</span></p></dd><dt><a class='title-link' name='phonebook' href='#phonebook'></a> phonebook</dt><dd><p class='desc'><span class='type'>(<span class='integer'>integer</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Numerical ID identifying the phonebook to be used. If there is just one phonebook, this is usually 0.</p>
</span></p><p class='default'>
Default value: <p>0</p>
</p></dd><dt><a class='title-link' name='prefixes' href='#prefixes'></a> prefixes</dt><dd><p class='desc'><span class='type'>(<span class='list'>list</span>)</span><span class='required'>(Optional)</span><span class='description'><p>In case of a local call, the phone number seen by the router might differ from the one stored in the phone book by an area code, similarly for the international prefix. To remedy this, a list of prefixes, that can be appended to the phone number in case it is not found in the phone book, can be given.</p>
</span></p></dd></dl>
</div>
<h2>Examples</h2>
<h3>Full configuration</h3>
<p>The example below shows a full configuration for a call monitor with phone book support.</p>
<pre><code class="language-yaml"># Example configuration.yaml entry
sensor:
  - platform: fritzbox_callmonitor
    name: Phone
    username: my_username
    password: my_password
    phonebook: 0
    prefixes:
      - '+49'
      - '+4989'
      - '089'
</code></pre>
<h3>Send notifications on state change</h3>
<p>This example shows how to send notifications whenever the sensor’s state changes. You will get notified both when you receive a call and also when a call is placed.</p>
<pre><code class="language-yaml"># Example configuration.yaml entry.
automation:
  - alias: &quot;Notify about phone state&quot;
    trigger:
      - platform: state
        entity_id: sensor.phone
    action:
      - service: notify.notify
        data_template:
          title: &quot;Phone&quot;
          message: &gt;-
            {% if is_state(&quot;sensor.phone&quot;, &quot;idle&quot;) %}
              Phone is idle
            {% elif is_state(&quot;sensor.phone&quot;, &quot;dialing&quot;) %}
              Calling {{ state_attr('sensor.phone', 'to_name') }} ({{ state_attr('sensor.phone', 'to') }})
            {% elif is_state(&quot;sensor.phone&quot;, &quot;ringing&quot;) %}
              Incoming call from {{ state_attr('sensor.phone', 'from_name') }} ({{ state_attr('sensor.phone', 'from') }})
            {% else %}
              Talking to {{ state_attr('sensor.phone', 'with_name') }} ({{ state_attr('sensor.phone', 'with') }})
            {% endif %}
</code></pre>
:ET