I"ê<p>The <code>Xiaomi</code> camera platform allows you to utilize Xiaomi Cameras within Home Assistant.</p>
<p>To successfully implement this platform, the Home Assistant host should be capable of multiple simultaneous reads. For every concurrent Home Assistant user, a connection will be made to the camera every 10 seconds. This should normally not be a problem.</p>
<h2>Preparing the Device</h2>
<p>In order to integrate the camera with Home Assistant, it is necessary to install a custom firmware on the device. Instructions for doing so can be found for each models.</p>
<ul>
<li><a href="https://github.com/fritz-smh/yi-hack">Yi 720p</a></li>
<li><a href="https://github.com/shadow-1/yi-hack-v3">Yi Home 17CN / 27US / 47US / 1080p Home / Dome / 1080p Dome</a></li>
<li><a href="https://github.com/samtap/fang-hacks">Xiaofang 1080p Camera</a></li>
</ul>
<p>Once installed, please ensure that you have enabled FTP.</p>
<div class='note warning'>
<p>Currently, version 0.1.4-beta2 of the custom firmware is the highest supported. Firmwares higher than this version use <a href="https://www.pureftpd.org/project/pure-ftpd">Pure-FTPd</a>, which has a bug that prevents FFmpeg from correctly rendering video files.</p>
</div>
<div class='note warning'>
<p>Raspbian users: Donâ€™t forget to install <code>ffmpeg</code> support on your platform, otherwise, youâ€™ll not see video.</p>
</div>
<div class='note warning'>
The live stream writing by the camera is not a supported format when the hass reads through FTP for Yi 720p and Xiaofang Cameras, so this platform retrives the video which was saved 1 minute earlier.
</div>
<div class='note warning'>
If you enabled RTSP server, you can connect to your camera via other Home Assistant camera platforms. However, this RTSP server disables the ability to use the supremely-useful Mi Home app. In order to maintain both Home Assistant compatibility _and_ the native app, this platform retrieves videos via FTP.
</div>
<h2>Configuring the Platform</h2>
<p>To enable the platform, add the following lines to your<code>configuration.yaml</code> file:</p>
<pre><code class="language-yaml">camera:
  - platform: xiaomi
    name: Camera
    host: '192.168.1.100'
    model: 'yi'
    password: YOUR_PASSWORD
</code></pre>
<div class="config-vars">
  <h3><a class="title-link" name="configuration-variables" href="#configuration-variables"></a> Configuration Variables</h3>
  <dl class=''><dt><a class='title-link' name='name' href='#name'></a> name</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>A human-friendly name for the camera.</p>
</span></p></dd><dt><a class='title-link' name='host' href='#host'></a> host</dt><dd><p class='desc'><span class='type'>(<span class='template'><a href="/docs/configuration/templating/">template</a></span>)</span><span class='required'>(Required)</span><span class='description'><p>The IP address or hostname of the camera.</p>
</span></p></dd><dt><a class='title-link' name='model' href='#model'></a> model</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>The model of Xiaomi Camera, currently supporting yi and xiaofang.</p>
</span></p></dd><dt><a class='title-link' name='password' href='#password'></a> password</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>The password to the FTP server on the camera (from above), can be any string as the current firmware doesnâ€™t allow setting ftp passwords.</p>
</span></p></dd><dt><a class='title-link' name='path' href='#path'></a> path</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>The path to the raw MP4 files.</p>
</span></p><p class='default'>
Default value: <p>/media/mmcblk0p1/record</p>
</p></dd><dt><a class='title-link' name='username' href='#username'></a> username</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>The user that can access the FTP server.</p>
</span></p><p class='default'>
Default value: <p>root</p>
</p></dd><dt><a class='title-link' name='ffmpeg_arguments' href='#ffmpeg_arguments'></a> ffmpeg_arguments</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Extra options to pass to <code>ffmpeg</code>.</p>
</span></p></dd></dl>
</div>
<div class='note'>
<p>The default for <code>path:</code> will not work with all cameras. It may be needed that you add that key with the exact path for your device.</p>
</div>
<h2>Image quality</h2>
<p>Any option supported by <a href="/integrations/camera.ffmpeg/"><code>ffmpeg</code> camera</a> can be utilized via the <code>ffmpeg_arguments</code> configuration parameter.</p>
<p>One particularly useful adjustment deals with video size. Since Yi videos are fairly large (especially on the 1080p cameras), the following configuration will bring them down to a manageable size:</p>
<pre><code class="language-yaml">camera:
  - platform: xiaomi
    name: My Camera
    host: '192.168.1.100'
    model: 'xiaofang'
    password: YOUR_PASSWORD
    path: /home/camera/feed
    ffmpeg_arguments: '-vf scale=800:450'
</code></pre>
<h2>Hostname template</h2>
<p>The hostname/IP address can be provided either a value or from the existing entity attributes.</p>
<pre><code class="language-yaml">camera:
  - platform: xiaomi
    name: Front Camera
    host: &quot;&quot;
    model: 'yi'
    password: 1234
    path: /tmp/sd/record
</code></pre>
:ET