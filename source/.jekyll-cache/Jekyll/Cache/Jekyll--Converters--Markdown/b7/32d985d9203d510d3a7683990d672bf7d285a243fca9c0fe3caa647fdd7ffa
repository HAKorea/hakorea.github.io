I"Í<p>The <code>google_pubsub</code> integration allows you to hook into the Home Assistant event bus and send events to <a href="https://cloud.google.com/pubsub/docs/overview">Google Cloud Pub/Sub</a>. The current <a href="https://cloud.google.com/free/">free tier</a> of GCP should allow you to sync about 1 event every 2 seconds on average (2 million invocations per month).</p>
<h2>First time setup</h2>
<p>This assumes you already have a Google Cloud project. If you don‚Äôt, please create one in the <a href="https://console.cloud.google.com/projectcreate">Google Cloud Console</a></p>
<p>You need to create a Service Account key in the <a href="https://console.cloud.google.com/apis/credentials/serviceaccountkey">Google Cloud API Console</a></p>
<ul>
<li>Choose a new ‚ÄúNew Service Account‚Äù, give it a name and leave the key type as JSON</li>
<li>Select the role: Pub/Sub Publisher</li>
</ul>
<p>This will download the Service Account JSON key to your machine. Do NOT share this with anyone. Place this file in your Home Assistant config folder.</p>
<p>Next, create a Google Pub/Sub topic in the <a href="https://console.cloud.google.com/cloudpubsub/topicList">Google Cloud API Console</a>. The topic name will become something like <code>projects/project-198373/topics/topic-name</code>. Note the last part only (the name you chose): <code>topic-name</code>.</p>
<h2>Configuration</h2>
<p>Add the following lines to your <code>configuration.yaml</code> file:</p>
<pre><code class="language-yaml"># Example configuration.yaml entry
google_pubsub:
  project_id: YOUR_PROJECT_ID
  topic_name: YOUR_TOPIC_NAME
  credentials_json: CREDENTIALS_FILENAME
</code></pre>
<div class="config-vars">
  <h3><a class="title-link" name="configuration-variables" href="#configuration-variables"></a> Configuration Variables</h3>
  <dl class=''><dt><a class='title-link' name='project_id' href='#project_id'></a> project_id</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>Project ID from the Google console (looks like <code>words-2ab12</code>).</p>
</span></p></dd><dt><a class='title-link' name='topic_name' href='#topic_name'></a> topic_name</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>The Pub/Sub <a href="https://cloud.google.com/pubsub/docs/admin#resource_names">relative</a> topic name (looks like <code>hass</code>).</p>
</span></p></dd><dt><a class='title-link' name='credentials_json' href='#credentials_json'></a> credentials_json</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>The filename of the Google Service Account JSON file.</p>
</span></p></dd><dt><a class='title-link' name='filter' href='#filter'></a> filter</dt><dd><p class='desc'><span class='type'>(<span class='map'>map</span>)</span><span class='required'>(Required)</span><span class='description'><p>Filter domains and entities for Google Cloud Pub/Sub.</p>
</span></p></dd><dd><dl class='nested'><dt><a class='title-link' name='include_domains' href='#include_domains'></a> include_domains</dt><dd><p class='desc'><span class='type'>(<span class='list'>list</span>)</span><span class='required'>(Optional)</span><span class='description'><p>List of domains to include (e.g., <code>light</code>).</p>
</span></p></dd><dt><a class='title-link' name='exclude_domains' href='#exclude_domains'></a> exclude_domains</dt><dd><p class='desc'><span class='type'>(<span class='list'>list</span>)</span><span class='required'>(Optional)</span><span class='description'><p>List of domains to exclude (e.g., <code>light</code>).</p>
</span></p></dd><dt><a class='title-link' name='include_entities' href='#include_entities'></a> include_entities</dt><dd><p class='desc'><span class='type'>(<span class='list'>list</span>)</span><span class='required'>(Optional)</span><span class='description'><p>List of entities to include (e.g., <code>light.attic</code>).</p>
</span></p></dd><dt><a class='title-link' name='exclude_entities' href='#exclude_entities'></a> exclude_entities</dt><dd><p class='desc'><span class='type'>(<span class='list'>list</span>)</span><span class='required'>(Optional)</span><span class='description'><p>List of entities to include (e.g., <code>light.attic</code>).</p>
</span></p></dd></dl></dd></dl>
</div>
<div class='note warning'>
  Not filtering domains or entities will send every event to Google PubSub, thus hitting the free tier limit very fast. Be sure to fill in this configuration parameter or have a paid subscription for Google Cloud.
</div>
<h3>Saving the data using a Google Cloud Function</h3>
<p>To save your data automatically to BigQuery, follow the <a href="https://github.com/timvancann/home-assistant-pubsub-cloud-function">instructions here</a>. The current <a href="https://cloud.google.com/free/">free tier</a> of GCP should allow to store up to 10GB of data.</p>
:ET