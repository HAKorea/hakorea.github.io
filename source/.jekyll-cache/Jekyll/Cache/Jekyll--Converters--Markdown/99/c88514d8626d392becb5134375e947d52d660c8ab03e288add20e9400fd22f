I"ÅG<p>The <code>influxdb</code> integration makes it possible to transfer all state changes to an external <a href="https://influxdb.com/">InfluxDB</a> database. See the <a href="https://docs.influxdata.com/influxdb/v1.7/introduction/installation/">official installation documentation</a> for how to set up an InfluxDB database, or if you‚Äôre using Hass.io, <a href="https://community.home-assistant.io/t/community-hass-io-add-on-influxdb/54491">there is a community add-on</a> available.</p>
<p>There is currently support for the following device types within Home Assistant:</p>
<ul>
<li><a href="#sensor">Sensor</a></li>
</ul>
<div class='note'>
<p>The <code>influxdb</code> database integration runs parallel to the Home Assistant database. It does not replace it.</p>
</div>
<h2>Configuration</h2>
<p>The default InfluxDB configuration doesn‚Äôt enforce authentication. If you have installed InfluxDB on the same host where Home Assistant is running and haven‚Äôt made any configuration changes, add the following to your <code>configuration.yaml</code> file:</p>
<pre><code class="language-yaml"># Example configuration.yaml entry
influxdb:
</code></pre>
<p>You will still need to create a database named <code>home_assistant</code> via InfluxDB‚Äôs command line interface. For instructions on how to create a database check the <a href="https://docs.influxdata.com/influxdb/latest/introduction/getting_started/#creating-a-database">InfluxDB documentation</a> relevant to the version you have installed.</p>
<div class="config-vars">
  <h3><a class="title-link" name="configuration-variables" href="#configuration-variables"></a> Configuration Variables</h3>
  <dl class=''><dt><a class='title-link' name='host' href='#host'></a> host</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>IP address of your database host, e.g., 192.168.1.10</p>
</span></p><p class='default'>
Default value: <p>localhost</p>
</p></dd><dt><a class='title-link' name='port' href='#port'></a> port</dt><dd><p class='desc'><span class='type'>(<span class='integer'>integer</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Port to use</p>
</span></p><p class='default'>
Default value: <p>8086</p>
</p></dd><dt><a class='title-link' name='username' href='#username'></a> username</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>The username of the database user. The user needs read/write privileges on the database</p>
</span></p></dd><dt><a class='title-link' name='password' href='#password'></a> password</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>The password for the database user account.</p>
</span></p></dd><dt><a class='title-link' name='database' href='#database'></a> database</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Name of the database to use. The database must already exist.</p>
</span></p><p class='default'>
Default value: <p>home_assistant</p>
</p></dd><dt><a class='title-link' name='ssl' href='#ssl'></a> ssl</dt><dd><p class='desc'><span class='type'>(<span class='boolean'>boolean</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Use https instead of http to connect.</p>
</span></p><p class='default'>
Default value: <p>false</p>
</p></dd><dt><a class='title-link' name='verify_ssl' href='#verify_ssl'></a> verify_ssl</dt><dd><p class='desc'><span class='type'>(<span class='boolean'>boolean</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Verify SSL certificate for https request.</p>
</span></p><p class='default'>
Default value: <p>true</p>
</p></dd><dt><a class='title-link' name='max_retries' href='#max_retries'></a> max_retries</dt><dd><p class='desc'><span class='type'>(<span class='integer'>integer</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Set this to allow the integration to retry if there was a network error when transmitting data.</p>
</span></p><p class='default'>
Default value: <p>0</p>
</p></dd><dt><a class='title-link' name='default_measurement' href='#default_measurement'></a> default_measurement</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Measurement name to use when an entity doesn‚Äôt have a unit.</p>
</span></p><p class='default'>
Default value: <p>uses the entity id of the entity</p>
</p></dd><dt><a class='title-link' name='override_measurement' href='#override_measurement'></a> override_measurement</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Measurement name to use instead of unit or default measurement. This will store all data points in a single measurement.</p>
</span></p></dd><dt><a class='title-link' name='exclude' href='#exclude'></a> exclude</dt><dd><p class='desc'><span class='type'>(<span class='list'>list</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Configure which integrations should be excluded from recording to InfluxDB.</p>
</span></p></dd><dd><dl class='nested'><dt><a class='title-link' name='entities' href='#entities'></a> entities</dt><dd><p class='desc'><span class='type'>(<span class='list'>list</span>)</span><span class='required'>(Optional)</span><span class='description'><p>The list of entity ids to be excluded from recording to InfluxDB.</p>
</span></p></dd><dt><a class='title-link' name='domains' href='#domains'></a> domains</dt><dd><p class='desc'><span class='type'>(<span class='list'>list</span>)</span><span class='required'>(Optional)</span><span class='description'><p>The list of domains to be excluded from recording to InfluxDB.</p>
</span></p></dd></dl></dd><dt><a class='title-link' name='include' href='#include'></a> include</dt><dd><p class='desc'><span class='type'>(<span class='list'>list</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Configure which integrations should be included in recordings to InfluxDB. If set, all other entities will not be recorded to InfluxDB. Values set by the <strong>exclude</strong> lists will take precedence.</p>
</span></p></dd><dd><dl class='nested'><dt><a class='title-link' name='entities' href='#entities'></a> entities</dt><dd><p class='desc'><span class='type'>(<span class='string list'>string | list</span>)</span><span class='required'>(Optional)</span><span class='description'><p>The list of entity ids to be included in recording to InfluxDB.</p>
</span></p></dd><dt><a class='title-link' name='domains' href='#domains'></a> domains</dt><dd><p class='desc'><span class='type'>(<span class='string list'>string | list</span>)</span><span class='required'>(Optional)</span><span class='description'><p>The list of domains to be included in recording to InfluxDB.</p>
</span></p></dd></dl></dd><dt><a class='title-link' name='tags' href='#tags'></a> tags</dt><dd><p class='desc'><span class='type'>(<span class='string list'>string | list</span>)</span><span class='description'><p>Tags to mark the data.</p>
</span></p><p class='default'>
Default value: <p>0</p>
</p></dd><dt><a class='title-link' name='tags_attributes' href='#tags_attributes'></a> tags_attributes</dt><dd><p class='desc'><span class='type'>(<span class='string list'>string | list</span>)</span><span class='required'>(Optional)</span><span class='description'><p>The list of attribute names which should be reported as tags and not fields to InfluxDB. For example, if set to <code>friendly_name</code>, it will be possible to group by entities‚Äô friendly names as well, in addition to their ids.</p>
</span></p><p class='default'>
Default value: <p>0</p>
</p></dd><dt><a class='title-link' name='component_config' href='#component_config'></a> component_config</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>This attribute contains component-specific override values. See <a href="/getting-started/customizing-devices/">Customizing devices and services</a> for format.</p>
</span></p></dd><dd><dl class='nested'><dt><a class='title-link' name='override_measurement' href='#override_measurement'></a> override_measurement</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Measurement name to use instead of unit or default measurement. This will store all data points in a single measurement.</p>
</span></p></dd></dl></dd><dt><a class='title-link' name='component_config_domain' href='#component_config_domain'></a> component_config_domain</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>This attribute contains domain-specific integration override values. See <a href="/getting-started/customizing-devices/">Customizing devices and services</a> for format.</p>
</span></p></dd><dd><dl class='nested'><dt><a class='title-link' name='override_measurement' href='#override_measurement'></a> override_measurement</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Measurement name to use instead of unit or default measurement. This will store all data points in a single measurement.</p>
</span></p></dd></dl></dd><dt><a class='title-link' name='component_config_glob' href='#component_config_glob'></a> component_config_glob</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>This attribute contains component-specific override values. See <a href="/getting-started/customizing-devices/">Customizing devices and services</a> for format.</p>
</span></p></dd><dd><dl class='nested'><dt><a class='title-link' name='override_measurement' href='#override_measurement'></a> override_measurement</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Measurement name to use instead of unit or default measurement. This will store all data points in a single measurement.</p>
</span></p></dd></dl></dd></dl>
</div>
<h2>Examples</h2>
<h3>Full configuration</h3>
<pre><code class="language-yaml">influxdb:
  host: 192.168.1.190
  port: 20000
  database: DB_TO_STORE_EVENTS
  username: MY_USERNAME
  password: MY_PASSWORD
  ssl: true
  verify_ssl: true
  max_retries: 3
  default_measurement: state
  exclude:
    entities:
       - entity.id1
       - entity.id2
    domains:
       - automation
  include:
    entities:
       - entity.id3
       - entity.id4
  tags:
    instance: prod
    source: hass
</code></pre>
<h2>Sensor</h2>
<p>The <code>influxdb</code> sensor allows you to use values from an <a href="https://influxdb.com/">InfluxDB</a> database to populate a sensor state. This can be use to present statistic about home_assistant sensors if used with the <code>influxdb</code> history component. It can also be used with an external data source.</p>
<p>To configure this sensor, you need to define the sensor connection variables and a list of queries to  your <code>configuration.yaml</code> file. A sensor will be created for each query:</p>
<pre><code class="language-yaml"># Example configuration.yaml entry
sensor:
  - platform: influxdb
    queries:
      - name: mean value of foo
        where: '&quot;name&quot; = ''foo'''
        measurement: '&quot;¬∞C&quot;'
</code></pre>
<div class="config-vars">
  <h3><a class="title-link" name="configuration-variables" href="#configuration-variables"></a> Configuration Variables</h3>
  <dl class=''><dt><a class='title-link' name='host' href='#host'></a> host</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>IP address of your database host, e.g. 192.168.1.10.</p>
</span></p><p class='default'>
Default value: <p>localhost</p>
</p></dd><dt><a class='title-link' name='port' href='#port'></a> port</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Port to use.</p>
</span></p><p class='default'>
Default value: <p>8086</p>
</p></dd><dt><a class='title-link' name='username' href='#username'></a> username</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>The username of the database user.</p>
</span></p></dd><dt><a class='title-link' name='password' href='#password'></a> password</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>The password for the database user account.</p>
</span></p></dd><dt><a class='title-link' name='ssl' href='#ssl'></a> ssl</dt><dd><p class='desc'><span class='type'>(<span class='boolean'>boolean</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Use https instead of http to connect.</p>
</span></p><p class='default'>
Default value: <p>false</p>
</p></dd><dt><a class='title-link' name='verify_ssl' href='#verify_ssl'></a> verify_ssl</dt><dd><p class='desc'><span class='type'>(<span class='boolean'>boolean</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Verify SSL certificate for https request.</p>
</span></p><p class='default'>
Default value: <p>false</p>
</p></dd><dt><a class='title-link' name='queries' href='#queries'></a> queries</dt><dd><p class='desc'><span class='type'>(<span class='list'>list</span>)</span><span class='required'>(Required)</span><span class='description'><p>List of queries.</p>
</span></p></dd><dd><dl class='nested'><dt><a class='title-link' name='name' href='#name'></a> name</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>The name of the sensor.</p>
</span></p></dd><dt><a class='title-link' name='unit_of_measurement' href='#unit_of_measurement'></a> unit_of_measurement</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Defines the units of measurement of the sensor, if any.</p>
</span></p></dd><dt><a class='title-link' name='measurement' href='#measurement'></a> measurement</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>Defines the measurement name in InfluxDB (the FROM clause of the query).</p>
</span></p></dd><dt><a class='title-link' name='where' href='#where'></a> where</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>Defines the data selection clause (the where clause of the query).</p>
</span></p></dd><dt><a class='title-link' name='value_template' href='#value_template'></a> value_template</dt><dd><p class='desc'><span class='type'>(<span class='template'><a href="/docs/configuration/templating/">template</a></span>)</span><span class='required'>(Optional)</span><span class='description'><p>Defines a <a href="/docs/configuration/templating/#processing-incoming-data">template</a> to extract a value from the payload.</p>
</span></p></dd><dt><a class='title-link' name='database' href='#database'></a> database</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Name of the database to use.</p>
</span></p><p class='default'>
Default value: <p>home_assistant</p>
</p></dd><dt><a class='title-link' name='group_function' href='#group_function'></a> group_function</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>The group function to be used.</p>
</span></p><p class='default'>
Default value: <p>mean</p>
</p></dd><dt><a class='title-link' name='field' href='#field'></a> field</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>The field name to select.</p>
</span></p><p class='default'>
Default value: <p>value</p>
</p></dd></dl></dd></dl>
</div>
<h2>Examples</h2>
<h3>Full configuration</h3>
<p>The example configuration entry below create two request to your local InfluxDB instance, one to the database <code>db1</code>, the other to <code>db2</code>:</p>
<ul>
<li><code>select last(value) as value from &quot;¬∞C&quot; where &quot;name&quot; = &quot;foo&quot;</code></li>
<li><code>select min(tmp) as value from &quot;%&quot; where &quot;entity_id&quot; = ''salon'' and time &gt; now() - 1h</code></li>
</ul>
<pre><code class="language-yaml">sensor:
  platform: influxdb
  host: localhost
  username: home-assistant
  password: password
  queries:
    - name: last value of foo
      unit_of_measurement: ¬∞C
      value_template: '{{ value | round(1) }}'
      group_function: last
      where: '&quot;name&quot; = ''foo'''
      measurement: '&quot;¬∞C&quot;'
      field: value
      database: db1
    - name: Min for last hour
      unit_of_measurement: '%'
      value_template: '{{ value | round(1) }}'
      group_function: min
      where: '&quot;entity_id&quot; = ''salon'' and time &gt; now() - 1h'
      measurement: '&quot;%&quot;'
      field: tmp
      database: db2
</code></pre>
:ET