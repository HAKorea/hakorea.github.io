I"?!<p>This integration allows you to monitor and manage your Habitica profile. This integration exposes the <a href="https://habitica.com/apidoc/">Habitica’s API</a> as a Home Assistant service. It supports multiple users and allows you to automate checking out your habits and daily tasks or casting magics using Home Assistant.</p>
<p>There is currently support for the following device types within Home Assistant:</p>
<ul>
<li>Sensor - Allows you to view and monitor your player data from <a href="https://habitica.com/">Habitica</a> in Home Assistant.</li>
</ul>
<p>The sensors will automatically appear, after setup the Habitica component.</p>
<p>To use the integration you should use this example configuration:</p>
<pre><code class="language-yaml"># Minimum viable configuration.yaml entry
habitica:
  - api_user: YOUR_USER_ID
    api_key: YOUR_API_KEY
</code></pre>
<p>You can specify several users, providing <code>api_user</code> and <code>api_key</code> for each.
At runtime you will be able to use API for each respective user by their Habitica’s username.
You can override this by passing <code>name</code> key, this value will be used instead of the username.
If you are hosting your own instance of Habitica, you can specify a URL to it in <code>url</code> key.</p>
<div class="config-vars">
  <h3><a class="title-link" name="configuration-variables" href="#configuration-variables"></a> Configuration Variables</h3>
  <dl class=''><dt><a class='title-link' name='api_user' href='#api_user'></a> api_user</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>Habitica’s API user ID. This value can be grabbed from <a href="https://habitica.com/user/settings/api">account setting</a></p>
</span></p></dd><dt><a class='title-link' name='api_key' href='#api_key'></a> api_key</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>Habitica’s API password (token). This value can be grabbed from <a href="https://habitica.com/user/settings/api">account setting</a> by pressing ‘Show API token’</p>
</span></p></dd><dt><a class='title-link' name='name' href='#name'></a> name</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Override for Habitica’s username. Will be used for service calls</p>
</span></p><p class='default'>
Default value: <p>Deduced at startup</p>
</p></dd><dt><a class='title-link' name='url' href='#url'></a> url</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>URL to your Habitica instance, if you are hosting your own</p>
</span></p><p class='default'>
Default value: <p><a href="https://habitica.com">https://habitica.com</a></p>
</p></dd><dt><a class='title-link' name='sensors' href='#sensors'></a> sensors</dt><dd><p class='desc'><span class='type'>(<span class='list'>list</span>)</span><span class='required'>(Optional)</span><span class='description'><p>List of sensors to generate for this user. If you don’t specify this entry then the default (all sensors) will be generated. If you specify this entry empty then no sensors will be generated.</p>
</span></p><p class='default'>
Default value: <p>all (<code>name</code>, <code>hp</code>, <code>maxHealth</code>, <code>mp</code>, <code>maxMP</code>, <code>exp</code>, <code>toNextLevel</code>, <code>lvl</code>, <code>gp</code>, <code>class</code>)</p>
</p></dd></dl>
</div>
<h3>API Service Parameters</h3>
<p>The API is exposed to Home Assistant as a service called <code>habitica.api_call</code>. To call it you should specify this keys in service data:</p>
<table>
<thead>
<tr>
<th>Service data attribute</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td>yes</td>
<td>string</td>
<td>Habitica’s username as per <code>configuration.yaml</code> entry.</td>
</tr>
<tr>
<td><code>path</code></td>
<td>yes</td>
<td>[string]</td>
<td>Items from API URL in form of an array with method attached at the end. See the example below.</td>
</tr>
<tr>
<td><code>args</code></td>
<td>no</td>
<td>map</td>
<td>Any additional json or url parameter arguments. See the example below and <a href="https://habitica.com/apidoc/">apidoc</a>.</td>
</tr>
</tbody>
</table>
<p>A successful call to this service will fire an event <code>habitica_api_call_success</code>.</p>
<table>
<thead>
<tr>
<th>Event data attribute</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td>string</td>
<td>Copied from service data attribute.</td>
</tr>
<tr>
<td><code>path</code></td>
<td>[string]</td>
<td>Copied from service data attribute.</td>
</tr>
<tr>
<td><code>data</code></td>
<td>map</td>
<td>Deserialized <code>data</code> field of JSON object Habitica’s server returned in response to api call. For more info see <a href="https://habitica.com/apidoc/">docs</a>.</td>
</tr>
</tbody>
</table>
<h4>Let’s consider some examples on how to call the service.</h4>
<p>For example, let’s say that there is a configured <code>habitica</code> platform for user <code>xxxNotAValidNickxxx</code> with their respective <code>api_user</code> and <code>api_key</code>.
Let’s create a new task (a todo) for this user via Home Assistant. There is an <a href="https://habitica.com/apidoc/#api-Task-CreateUserTasks">API call</a> for this purpose.
To create a new task one should hit <code>https://habitica.com/api/v3/tasks/user</code> endpoint with <code>POST</code> request with a json object with task properties.
So let’s call the API on <code>habitica.api_call</code>.</p>
<ul>
<li>The <code>name</code> key becomes <code>xxxNotAValidNickxxx</code>.</li>
<li>The <code>path</code> key is trickier.
<ul>
<li>Remove <code>https://habitica.com/api/v3/</code> at the beginning of the endpoint URL.</li>
<li>Split the remaining on slashes (/) and <strong>append the lowercase method</strong> at the end.</li>
<li>You should get <code>[&quot;tasks&quot;, &quot;user&quot;, &quot;post&quot;]</code>. To get a better idea of the API you are recommended to try all of the API calls in IPython console <a href="https://github.com/ASMfreaK/habitipy/blob/master/README.md">using this package</a>.</li>
</ul>
</li>
<li>The <code>args</code> key is more or less described in the <a href="https://habitica.com/apidoc/">docs</a>.</li>
</ul>
<p>Combining all together:
call <code>habitica.api_call</code> with data</p>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;xxxNotAValidNickxxx&quot;,
  &quot;path&quot;: [&quot;tasks&quot;, &quot;user&quot;, &quot;post&quot;],
  &quot;args&quot;: {&quot;text&quot;: &quot;Use API from Home Assistant&quot;, &quot;type&quot;: &quot;todo&quot;}
}
</code></pre>
<p>This call will create a new todo on <code>xxxNotAValidNickxxx</code>’s account with text <code>Use API from Home Assistant</code> like this:</p>
<p><img src="/images/screenshots/habitica_new_task.png" alt="example task created" /></p>
<p>Also an event <code>habitica_api_call_success</code> will be fired with the following data:</p>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;xxxNotAValidNickxxx&quot;,
  &quot;path&quot;: [&quot;tasks&quot;, &quot;user&quot;, &quot;post&quot;],
  &quot;data&quot;: {
    &quot;challenge&quot;: {},
    &quot;group&quot;: {&quot;approval&quot;: {&quot;required&quot;: false,
     &quot;approved&quot;: false,
     &quot;requested&quot;: false},
    &quot;assignedUsers&quot;: [],
    &quot;sharedCompletion&quot;: &quot;recurringCompletion&quot;},
    &quot;completed&quot;: false,
    &quot;collapseChecklist&quot;: false,
    &quot;type&quot;: &quot;todo&quot;,
    &quot;notes&quot;: &quot;&quot;,
    &quot;tags&quot;: [],
    &quot;value&quot;: 0,
    &quot;priority&quot;: 1,
    &quot;attribute&quot;: &quot;str&quot;,
    &quot;text&quot;: &quot;Use API from Home Assistant&quot;,
    &quot;checklist&quot;: [],
    &quot;reminders&quot;: [],
    &quot;_id&quot;: &quot;NEW_TASK_UUID&quot;,
    &quot;createdAt&quot;: &quot;2018-08-09T18:03:27.759Z&quot;,
    &quot;updatedAt&quot;: &quot;2018-08-09T18:03:27.759Z&quot;,
    &quot;userId&quot;: &quot;xxxNotAValidNickxxx's ID&quot;,
    &quot;id&quot;: &quot;NEW_TASK_UUID&quot;}
}
</code></pre>
:ET