I"[<p>The <code>mikrotik</code> platform offers presence detection by looking at connected devices to a <a href="https://mikrotik.com">MikroTik RouterOS</a> based router.</p>
<p>There is currently support for the following device types within Home Assistant:</p>
<ul>
<li>Presence Detection</li>
</ul>
<h2>Configuring <code>mikrotik</code> hub</h2>
<p>You have to enable accessing the RouterOS API on your router to use this platform.</p>
<p>Terminal:</p>
<pre><code class="language-bash">/ip service
set api disabled=no port=8728
</code></pre>
<p>Web Frontend:</p>
<p>Go to <strong>IP</strong> -&gt; <strong>Services</strong> -&gt; <strong>api</strong> and enable it.</p>
<p>Make sure that port 8728 or the port you choose is accessible from your network.</p>
<p>To use a MikroTik router in your installation, add the following to your <code>configuration.yaml</code> file:</p>
<pre><code class="language-yaml"># Example configuration.yaml entry
mikrotik:
  - host: IP_ADDRESS
    username: ROUTEROS_USERNAME
    password: ROUTEROS_PASSWORD
</code></pre>
<div class="config-vars">
  <h3><a class="title-link" name="configuration-variables" href="#configuration-variables"></a> Configuration Variables</h3>
  <dl class=''><dt><a class='title-link' name='host' href='#host'></a> host</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>The IP address of your MikroTik device.</p>
</span></p></dd><dt><a class='title-link' name='username' href='#username'></a> username</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>The username of a user on the MikroTik device.</p>
</span></p></dd><dt><a class='title-link' name='password' href='#password'></a> password</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Required)</span><span class='description'><p>The password of the given user account on the MikroTik device.</p>
</span></p></dd><dt><a class='title-link' name='login_method' href='#login_method'></a> login_method</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>The login method to use on the MikroTik device. The <code>plain</code> method is used by default, if you have an older RouterOS Version than 6.43, use <code>token</code> as the login method.</p>
</span></p><p class='default'>
Default value: <p>plain</p>
</p></dd><dt><a class='title-link' name='port' href='#port'></a> port</dt><dd><p class='desc'><span class='type'>(<span class='integer'>integer</span>)</span><span class='required'>(Optional)</span><span class='description'><p>RouterOS API port.</p>
</span></p><p class='default'>
Default value: <p>8728 (or 8729 if SSL is enabled)</p>
</p></dd><dt><a class='title-link' name='ssl' href='#ssl'></a> ssl</dt><dd><p class='desc'><span class='type'>(<span class='boolean'>boolean</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Use SSL to connect to the API.</p>
</span></p><p class='default'>
Default value: <p>false</p>
</p></dd><dt><a class='title-link' name='method' href='#method'></a> method</dt><dd><p class='desc'><span class='type'>(<span class='string'>string</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Override autodetection of device scanning method. Can be <code>wireless</code> to use local wireless registration, <code>capsman</code> for capsman wireless registration, or <code>dhcp</code> for DHCP leases.</p>
</span></p></dd><dt><a class='title-link' name='arp_ping' href='#arp_ping'></a> arp_ping</dt><dd><p class='desc'><span class='type'>(<span class='boolean'>boolean</span>)</span><span class='required'>(Optional)</span><span class='description'><p>Use ARP ping with DHCP method for device scanning.</p>
</span></p><p class='default'>
Default value: <p>false</p>
</p></dd></dl>
</div>
<div class='note info'>
<p>As of version 6.43 of RouterOS Mikrotik introduced a new login method (<code>plain</code>) in addition to the old login method (<code>token</code>). With Version 6.45.1 the old <code>token</code> login method got deprecated.
In order to support both login mechanisms, the new config option <code>login_method</code> has been introduced.</p>
</div>
<h2>Use a certificate</h2>
<p>To use SSL to connect to the API (via <code>api-ssl</code> instead of <code>api</code> service) further configuration is required at RouterOS side. You have to upload or generate a certificate and configure <code>api-ssl</code> service to use it. Here is an example of a self-signed certificate:</p>
<pre><code class="language-bash">/certificate add common-name=&quot;Self signed demo certificate for API&quot; days-valid=3650 name=&quot;Self signed demo certificate for API&quot; key-usage=digital-signature,key-encipherment,tls-server,key-cert-sign,crl-sign
/certificate sign &quot;Self signed demo certificate for API&quot;
/ip service set api-ssl certificate=&quot;Self signed demo certificate for API&quot;
/ip service enable api-ssl
</code></pre>
<p>Then add <code>ssl: true</code> to <code>mikrotik</code> device tracker entry in your <code>configuration.yaml</code> file.</p>
<p>If everything is working fine you can disable the pure <code>api</code> service in RouterOS:</p>
<pre><code class="language-bash">/ip service disable api
</code></pre>
<h2>The user privileges in RouterOS</h2>
<p>To use this device tracker you need restricted privileges only. To enhance the security of your MikroTik device create a “read only” user who is able to connect to API  and perform ping test only:</p>
<pre><code class="language-bash">/user group add name=homeassistant policy=read,api,!local,!telnet,!ssh,!ftp,!reboot,!write,!policy,test,!winbox,!password,!web,!sniff,!sensitive,!romon,!dude,!tikapp
/user add group=homeassistant name=homeassistant
/user set password=&quot;YOUR_PASSWORD&quot; homeassistant
</code></pre>
<h2>Using the additional configuration to the <code>mikrotik</code> entry in your <code>configuration.yaml</code> file:</h2>
<pre><code class="language-yaml">mikrotik:
  - host: 192.168.88.1
    username: homeassistant
    password: YOUR_PASSWORD
    ssl: true
    arp_ping: true
    method: dhcp
    track_devices: true

  - host: 192.168.88.2
    username: homeassistant
    password: YOUR_PASSWORD
    ssl: true
    port: 8729
    method: capsman
    track_devices: true
</code></pre>
<p>See the <a href="/integrations/device_tracker/">device tracker integration page</a> for instructions on how to configure the people to be tracked.</p>
:ET