I"#<p>This example demonstrates how you can configure Apache to act as a proxy for Home Assistant.</p>
<p>This is useful if you want to have:</p>
<ul>
<li>a subdomain redirecting to your Home Assistant instance</li>
<li>several subdomain for several instance</li>
<li>HTTPS redirection</li>
</ul>
<h4>Subdomain</h4>
<p>So you already have a working Apache server available at example.org. Your Home Assistant is correctly working on this web server and available at <code>http://localhost:8123</code></p>
<p>Enable <a href="https://httpd.apache.org/docs/2.4/mod/mod_proxy_wstunnel.html"><code>mod_proxy_wstunnel</code></a> by running if you encounter issues while serving Home Assistant through your proxy:</p>
<pre><code class="language-bash">$ sudo a2enmod proxy_wstunnel
</code></pre>
<p>To be able to access to your Home Assistant instance by using <code>https://home.example.org</code>, add the following file to <code>/etc/httpd/conf/extra/</code> as <code>hass.conf</code></p>
<pre><code class="language-text">&lt;VirtualHost *:443&gt;
  ServerName home.example.org
  ProxyPreserveHost On
  ProxyRequests off
  ProxyPass /api/websocket ws://localhost:8123/api/websocket
  ProxyPassReverse /api/websocket ws://localhost:8123/api/websocket
  ProxyPass / http://localhost:8123/
  ProxyPassReverse / http://localhost:8123/

  RewriteEngine on
  RewriteCond %{HTTP:Upgrade} =websocket [NC]
  RewriteRule /(.*)  ws://localhost:8123/$1 [P,L]
  RewriteCond %{HTTP:Upgrade} !=websocket [NC]
  RewriteRule /(.*)  http://localhost:8123/$1 [P,L]
&lt;/VirtualHost&gt;
</code></pre>
<p>and make sure that this file is read by Apache’s main configuration file <code>/etc/httpd/conf/httpd.conf</code></p>
<pre><code class="language-text">...
Include conf/extra/hass.conf
...
</code></pre>
<p>If you don’t want HTTPS, you can change <code>&lt;VirtualHost *:443&gt;</code> to <code>&lt;VirtualHost *:80&gt;</code> or better consider redirecting all HTTP to HTTPS.</p>
<div class='note'>
In case you are getting occasional HTTP 504 error messages ("Gateway Timeout") or HTTP 502 messages ("Bad Gateway") when accessing the Web UI through your proxy, try adding disablereuse=on to both ProxyPass directives:
</div>
<pre><code class="language-text">&lt;VirtualHost *:443&gt;
  [...]
  ProxyPass /api/websocket ws://localhost:8123/api/websocket disablereuse=on
  [...]
  ProxyPass / http://localhost:8123/ disablereuse=on
  [...]
&lt;/VirtualHost&gt;
</code></pre>
<h4>Multiple Instance</h4>
<p>You already have Home Assistant running on <code>http://localhost:8123</code> and available at home.example.org as describe before. The configuration file for this Home Assistant is available in <code>/home/alice/.homeassistant/configuration.yaml</code></p>
<p>You want another instance available at <code>https://countryside.example.org</code></p>
<p>You can either :</p>
<ul>
<li>Create a new user, <code>bob</code>, to hold the configuration file in <code>/home/bob/.homeassistant/configuration.yaml</code> and run Home Assistant as this new user</li>
<li>Create another configuration directory in <code>/home/alice/.homeassistan2/configuration.yaml</code> and run Home Assistant using <code>hass --config /home/alice/.homeassistant2/</code></li>
</ul>
<p>In both solution, change port number used by modifying <code>configuration.yaml</code></p>
<pre><code class="language-yaml">http:
  server_port: 8124
  ...
</code></pre>
<p>Start Home Assistant: Now, you have another instance running on <code>http://localhost:8124</code></p>
<p>To access this instance by using <code>https://countryside.example.org</code> add to <code>/etc/httpd/conf/extra/hass.conf</code></p>
<pre><code class="language-text">&lt;VirtualHost *:443&gt;
  ProxyPreserveHost On
  ProxyRequests Off
  ServerName countryside.example.org
  ProxyPass /api/websocket ws://localhost:8123/api/websocket
  ProxyPassReverse /api/websocket ws://localhost:8123/api/websocket
  ProxyPass / http://localhost:8124/
  ProxyPassReverse / http://localhost:8124/
&lt;/VirtualHost&gt;
</code></pre>
<h4>HTTP to HTTPS redirection</h4>
<p>Add to your <code>/etc/httpd/conf/extra/hass.conf</code></p>
<pre><code class="language-text">&lt;VirtualHost *:80&gt;
  ServerName example.org
  ServerSignature Off

  RewriteEngine on
  RewriteCond %{HTTPS} !=on
  RewriteRule .* https://%{SERVER_NAME}%{REQUEST_URI} [NE,R,L]
&lt;/VirtualHost&gt;
</code></pre>
:ET